import{d as ae,m as D,r as w,q as F,h as y,c as V,e as n,w as i,a as d,i as T,t as c,u as r,s as o,F as te,T as le,v as C,R as E,B as se,a0 as B,a3 as re,a$ as oe,U as L,ab as ne,aC as ie,L as ue,K as pe,E as de,M as ce,ac as me,J as _e,ad as fe,W as ge,X as he,Y as ve,p as ye,g as xe}from"./index-0e396751.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                *//* empty css                  */import"./el-form-item-4ed993c7.js";import{_ as R}from"./default_img-44957769.js";import{g as be,a as ke}from"./treasure-315db2bb.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";const Se=x=>(ye("data-v-6d2b2a3d"),x=x(),xe(),x),Pe={class:"flex items-center cursor-pointer"},we={class:"min-w-[70px] h-[70px] flex items-center justify-center"},Ve=Se(()=>d("div",{class:"image-slot"},[d("img",{class:"w-[70px] h-[70px]",src:R})],-1)),Ce={key:1,class:"w-[70px] h-[70px]",src:R,fit:"contain"},Ee={class:"ml-2 flex flex-col items-start"},Ie=["title"],Ne={class:"text-primary text-[12px]"},$e={class:"mt-[16px] flex"},De={class:"flex items-center flex-1"},Fe={class:"layui-table-bottom-left-container mr-[10px]"},Be={class:"text-primary mx-[2px]"},Le={class:"dialog-footer"},Re=ae({__name:"treasure-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue","treasurSelect"],setup(x,{expose:U,emit:I}){const m=x,_=D({get(){return m.modelValue},set(t){I("update:modelValue",t)}}),g=w(!1),u=F({}),h=D(()=>Object.keys(u).length),a=F({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",relate_type:"",select_type:"all",treasure_ids:""}}),N=w(),z=()=>{f()},b=w([]),j=()=>{ke().then(t=>{const e=t.data;if(e){b.value=[];for(const p in e){const l={value:p,label:e[p]};b.value.push(l)}b.value.length&&(a.searchParam.relate_type=b.value[0].value),f(1,p=>{if(_.value){_.value.splice(0,_.value.length,...p),_.value.forEach(l=>{u["treasure_"+l]||(u["treasure_"+l]={})});for(let l=0;l<a.data.length;l++)_.value.indexOf(a.data[l].treasure_id)!=-1&&(u["treasure_"+a.data[l].treasure_id]=a.data[l])}})}})},S=w(),M=(t,e)=>{let p=!1;for(let l=0;l<t.length;l++)if(t[l].treasure_id==e.treasure_id){p=!0;break}p?u["treasure_"+e.treasure_id]=e:delete u["treasure_"+e.treasure_id]},O=t=>{t.length?t.forEach(e=>{u["treasure_"+e.treasure_id]=e}):a.data.forEach(e=>{delete u["treasure_"+e.treasure_id]})},f=(t=1,e=null)=>{a.loading=!0,a.page=t;const p=re(a.searchParam);if(p.select_type=="selected"){const l=[];for(let v in u)l.push(parseInt(v.replace("treasure_","")));p.treasure_ids=l}be({page:a.page,limit:a.limit,...p}).then(l=>{a.data=l.data.data,a.total=l.data.total,a.loading=!1,e&&e(l.data.treasure_ids),$()}).catch(()=>{a.loading=!1})},$=()=>{oe(()=>{if(S.value)for(let t=0;t<a.data.length;t++)S.value.toggleRowSelection(a.data[t],!1),u["treasure_"+a.data[t].treasure_id]&&S.value.toggleRowSelection(a.data[t],!0)})},A=t=>{t&&(t.resetFields(),f())},q=()=>{for(const t in u)delete u[t];a.searchParam.treasure_ids=_.value,j(),g.value=!0},G=()=>{for(const t in u)delete u[t];a.searchParam.treasure_ids="",f(),$()},J=()=>{if(m.min&&h.value<m.min){L({type:"warning",message:`${o("treasureMinTip")}${m.min}${o("treasurePiece")}`});return}if(m.max&&m.max>0&&h.value&&h.value>m.max){L({type:"warning",message:`${o("treasureMaxTip")}${m.max}${o("treasurePiece")}`});return}const t=[];for(const e in u)t.push(parseInt(e.replace("treasure_","")));_.value.splice(0,_.value.length,...t),I("treasurSelect",Object.values(u)),g.value=!1};return U({open:q,showDialog:g}),(t,e)=>{const p=ne,l=ie,v=ue,K=pe,k=de,W=ce,P=me,X=_e,Y=fe,H=ge,Q=he,Z=ve;return y(),V("div",null,[n(Q,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=s=>g.value=s),title:r(o)("treasureList"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:i(()=>[d("span",Le,[n(k,{onClick:e[8]||(e[8]=s=>g.value=!1)},{default:i(()=>[T(c(r(o)("cancel")),1)]),_:1}),n(k,{type:"primary",onClick:J},{default:i(()=>[T(c(r(o)("confirm")),1)]),_:1})])]),default:i(()=>[n(W,{inline:!0,model:a.searchParam,ref_key:"searchFormRef",ref:N},{default:i(()=>[n(v,{prop:"select_type",class:"form-item-wrap"},{default:i(()=>[n(l,{modelValue:a.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=s=>a.searchParam.select_type=s),onChange:z},{default:i(()=>[n(p,{label:r(o)("alltreasures"),value:"all"},null,8,["label"]),n(p,{label:r(o)("selectedtreasure"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),n(v,{label:r(o)("treasuresName"),prop:"keyword",class:"form-item-wrap"},{default:i(()=>[n(K,{modelValue:a.searchParam.keyword,"onUpdate:modelValue":e[1]||(e[1]=s=>a.searchParam.keyword=s),modelModifiers:{trim:!0},placeholder:r(o)("treasuresNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{label:r(o)("relateTypeName")},{default:i(()=>[n(l,{modelValue:a.searchParam.relate_type,"onUpdate:modelValue":e[2]||(e[2]=s=>a.searchParam.relate_type=s),placeholder:r(o)("relateTypeNamePlaceholder")},{default:i(()=>[(y(!0),V(te,null,le(b.value,(s,ee)=>(y(),C(p,{key:ee,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(v,{class:"form-item-wrap"},{default:i(()=>[n(k,{type:"primary",onClick:e[3]||(e[3]=s=>f())},{default:i(()=>[T(c(r(o)("search")),1)]),_:1}),n(k,{onClick:e[4]||(e[4]=s=>A(N.value))},{default:i(()=>[T(c(r(o)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),E((y(),C(Y,{data:a.data,size:"large",ref_key:"treasureListTableRef",ref:S,"max-height":"400",onSelect:M,onSelectAll:O},{empty:i(()=>[d("span",null,c(a.loading?"":r(o)("emptyData")),1)]),default:i(()=>[n(P,{type:"selection",width:"55"}),n(P,{label:r(o)("treasureInfo"),"min-width":"300"},{default:i(({row:s})=>[d("div",Pe,[d("div",we,[s.treasure_image?(y(),C(X,{key:0,class:"w-[70px] h-[70px]",src:r(se)(s.treasure_image),fit:"contain"},{error:i(()=>[Ve]),_:2},1032,["src"])):(y(),V("img",Ce))]),d("div",Ee,[d("span",{title:s.treasure_name,class:"multi-hidden"},c(s.treasure_name),9,Ie),d("span",Ne,c(s.treasure_sub_name),1)])])]),_:1},8,["label"]),n(P,{prop:"relate_type_name",label:r(o)("relateTypeName"),"min-width":"120"},null,8,["label"]),n(P,{prop:"treasure_price",label:r(o)("treasurePrice"),"min-width":"120"},null,8,["label"])]),_:1},8,["data"])),[[Z,a.loading]]),d("div",$e,[d("div",De,[E(d("div",Fe,[d("span",null,c(r(o)("treasureBeforeTip")),1),d("span",Be,c(r(h)),1),d("span",null,c(r(o)("treasureAfterTip")),1)],512),[[B,r(h)]]),E(n(k,{type:"primary",link:"",onClick:G},{default:i(()=>[T(c(r(o)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[B,r(h)]])]),n(H,{"current-page":a.page,"onUpdate:current-page":e[5]||(e[5]=s=>a.page=s),"page-size":a.limit,"onUpdate:page-size":e[6]||(e[6]=s=>a.limit=s),layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:e[7]||(e[7]=s=>f()),onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const na=Te(Re,[["__scopeId","data-v-6d2b2a3d"]]);export{na as default};
