import{d as L,r as f,n as O,h as b,s as M,w as d,a as r,e as l,i as v,t as u,u as t,q as a,B as R,c as V,cb as z,a3 as K,K as P,L as S,M as $,ad as q,aa as A,ae as G,E as X,X as H}from"./index-904cb7a2.js";/* empty css                  *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 */import{o as J}from"./order-8e8307b0.js";const Q={class:"max-h-[600px] overflow-y-auto"},W={class:"panel-title ml-[10px]"},Y={class:"mb-[20px]"},Z={class:"multi-hidden text-[14px]"},ee=r("text",{class:"nc-iconfont nc-icon-bangzhuV6xx ml-[5px] text-[12px]"},null,-1),oe=r("h3",{class:"panel-title ml-[10px]"},[r("span",{class:"text-primary"},"实际商品金额"),r("span",null," = 商品总额 - 优惠金额 + 调价")],-1),te={class:"panel-title ml-[10px]"},ae=r("span",{class:"text-primary"},"订单总额",-1),le={key:0},ne={key:1},se={class:"dialog-footer"},Me=L({__name:"adjust-money",emits:["complete"],setup(de,{expose:w,emit:E}){const _=f(!1),y=f(!1),n=O({}),m=f(0),g=f([]),F=o=>{z(o),m.value=o.target.value},k=o=>{for(let e in n)delete n[e];Object.assign(n,K(o)),n.order_goods=n.order_goods.filter(e=>e.is_gift!=1),g.value=[],n.order_goods.forEach(e=>{e.adjust_money="",e.total=(parseFloat(e.goods_money)-parseFloat(e.discount_money)).toFixed(2),g.value.push(e.goods_type)}),m.value=n.delivery_money},C=(o,e,c)=>{let i=parseFloat(c.goods_money)-parseFloat(c.discount_money);o.length==0||isNaN(o)?(o=0,n.order_goods[e].adjust_money=""):o=parseFloat(o),parseFloat(o)+i<0?(o=i,n.order_goods[e].adjust_money=-o,i=0):i+=o,i=Math.round(i*100)/100,n.order_goods[e].total=i.toFixed(2)},h=f(!1),D=()=>{if(y.value=!0,h.value)return;h.value=!0;let o={};n.order_goods.forEach(e=>{e.adjust_money&&(o[e.order_goods_id]={money:e.adjust_money})}),J({order_id:n.order_id,delivery_money:parseFloat(m.value),order_goods_data:o}).then(e=>{h.value=!1,y.value=!1,_.value=!1,E("complete")}).catch(()=>{h.value=!1,y.value=!1})};return w({showDialog:_,setFormData:k}),(o,e)=>{const c=P,i=S,T=$,p=q,N=A,B=G,j=X,U=H;return b(),M(U,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),title:t(a)("adjustMoneyDialogTitle"),width:"1000px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:d(()=>[r("span",se,[l(j,{onClick:e[2]||(e[2]=s=>_.value=!1)},{default:d(()=>[v(u(t(a)("cancel")),1)]),_:1}),l(j,{type:"primary",loading:y.value,onClick:e[3]||(e[3]=s=>D(o.formRef))},{default:d(()=>[v(u(t(a)("confirm")),1)]),_:1},8,["loading"])])]),default:d(()=>[r("div",Q,[r("h3",W,u(t(a)("adjustMoneyTips")),1),g.value.indexOf("real")!=-1?(b(),M(T,{key:0,"label-width":"50px",ref:"formRef",class:"page-form"},{default:d(()=>[l(i,{label:t(a)("adjustMoneyDeliveryMoney"),prop:"express_number"},{default:d(()=>[l(c,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),modelModifiers:{trim:!0},clearable:"",placeholder:"0.00",class:"!w-[200px]",maxlength:"8",onKeyup:e[1]||(e[1]=s=>F(s))},{append:d(()=>[v(u(t(a)("adjustMoneyUnit")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512)):R("",!0),r("div",Y,[l(B,{data:n.order_goods,size:"large"},{default:d(()=>[l(p,{label:t(a)("adjustMoneyGoodsInfo"),align:"left",width:"200"},{default:d(({row:s})=>[r("p",Z,u(s.goods_name),1)]),_:1},8,["label"]),l(p,{prop:"price",label:t(a)("adjustMoneyPrice"),"min-width":"50",align:"left"},null,8,["label"]),l(p,{prop:"num",label:t(a)("adjustMoneyNum"),"min-width":"50",align:"right"},null,8,["label"]),l(p,{prop:"goods_money",label:t(a)("adjustMoneySubTotal"),"min-width":"50",align:"right"},null,8,["label"]),l(p,{prop:"discount_money",label:t(a)("adjustMoneyDiscountMoney"),"min-width":"50",align:"right"},null,8,["label"]),l(p,{prop:"goods_name",label:t(a)("adjustMoneyLabel"),"min-width":"100"},{header:d(()=>[r("div",null,[r("span",null,u(t(a)("adjustMoneyLabel")),1),l(N,{effect:"dark",content:"负数表示下调金额，正数表示上调金额",placement:"top"},{default:d(()=>[ee]),_:1})])]),default:d(({row:s,$index:I})=>[l(c,{modelValue:s.adjust_money,"onUpdate:modelValue":x=>s.adjust_money=x,modelModifiers:{trim:!0},clearable:"",placeholder:"0.00",maxlength:"6",onChange:x=>C(x,I,s)},{append:d(()=>[v(u(t(a)("adjustMoneyUnit")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(p,{prop:"total",label:t(a)("adjustMoneyTotal"),"min-width":"70",align:"right"},null,8,["label"])]),_:1},8,["data"])]),oe,r("h3",te,[ae,g.value.indexOf("real")!=-1?(b(),V("span",le," = 实际商品金额 + 运费")):(b(),V("span",ne," = 实际商品金额"))])])]),_:1},8,["modelValue","title"])}}});export{Me as _};
