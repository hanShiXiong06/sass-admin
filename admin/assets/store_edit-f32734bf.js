import{d as X,y as Z,r as y,q as S,cU as L,aJ as ee,ct as te,cV as ae,m as ie,s as o,Q as g,ap as le,h as _,c as M,e as r,w as c,u as s,R as G,v as E,bU as oe,a as w,t as U,F as B,T as D,i as Q,aQ as re,a7 as de,K as se,L as ne,ab as ce,aC as ue,M as me,E as pe,Y as _e}from"./index-0e396751.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import fe from"./index-11d71036.js";import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{t as ve,u as be,v as ye}from"./delivery-fe1f6e47.js";import{c as ge,l as he,a as Le}from"./qqmap-011f3cfb.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-d82568af.js";/* empty css                  *//* empty css                   */import"./attachment-c52133c7.js";import"./index.vue_vue_type_script_setup_true_lang-34f8a01a.js";/* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-077a27b1.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-5014406f.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./sortable.esm-be94e56d.js";const we={class:"main-container"},Ve={class:"text-[12px] text-[#999]"},ke={id:"container",class:"w-[800px] h-[520px] relative"},xe={class:"fixed-footer-wrap"},Pe={class:"fixed-footer !z-[9999]"},pt=X({__name:"store_edit",setup(Me){const F=Z(),V=parseInt(F.query.id),f=y(!1);F.meta.title;const m=S({province:[],city:[],district:[]}),k=y(),x=y(),P=y();L(0).then(i=>{m.province=i.data});let T="";ee(()=>{const i=document.createElement("script");te().then(t=>{T=t.data.key,i.type="text/javascript",i.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+t.data.key,document.body.appendChild(i)}),i.onload=()=>{setTimeout(()=>{$()},500)}});let v,C;const N=y(!0),$=()=>{const i=window.TMap,t=i.LatLng,a=new t(e.latitude,e.longitude);v=new i.Map("container",{center:a,zoom:14}),v.on("tilesloaded",()=>{N.value=!1}),C=ge(v),v.on("click",d=>{v.setCenter(d.latLng),C.updateGeometries({id:"center",position:d.latLng}),j(d.latLng.lat,d.latLng.lng)}),j(a.lat,a.lng)},u=S({province_id:0,city_id:0,district_id:0}),j=(i,t)=>{he({mapKey:T,lat:i,lng:t}).then(({message:a,result:d})=>{a=="query ok"||a=="Success"?(e.latitude=d.location.lat,e.longitude=d.location.lng,e.address=d.formatted_addresses.recommend,ae(d.ad_info.adcode).then(({data:n})=>{u.province_id=n.province?n.province.id:0,u.city_id=n.city?n.city.id:0,u.district_id=n.district?n.district.id:0})):console.error(a,d)}).catch(a=>{console.log(a)})},A={store_id:0,store_name:"",store_desc:"",store_logo:"",store_mobile:"",province_id:0,province_name:"",city_id:0,city_name:"",district_id:0,district_name:"",address:"",full_address:"",longitude:116.39719,latitude:39.908626,trade_time:""},e=S({...A});V&&(async(i=0)=>{f.value=!0,Object.assign(e,A);const t=await(await ve(i)).data;Object.keys(e).forEach(a=>{t[a]!=null&&(e[a]=t[a])}),f.value=!1})(V);const I=y(),H=ie(()=>({store_name:[{required:!0,message:o("storeNamePlaceholder"),trigger:"blur"}],store_logo:[{required:!0,message:o("storeLogoPlaceholder"),trigger:"blur"}],store_mobile:[{required:!0,message:o("storeMobilePlaceholder"),trigger:"blur"}],trade_time:[{required:!0,message:o("tradeTimePlaceholder"),trigger:"blur"}],address_area:[{validator:(i,t,a)=>{e.province_id||a(new Error(o("provincePlaceholder"))),e.city_id||a(new Error(o("cityPlaceholder"))),m.district.length&&!e.district_id&&a(new Error(o("districtPlaceholder"))),a()}}],address:[{required:!0,message:o("addressPlaceholder"),trigger:"blur"}]}));g(()=>e.province_id,i=>{i?L(e.province_id).then(t=>{m.city=t.data;const a=e.city_id;if(a){let d=!1;for(let n=0;n<t.data.length;n++)if(a==t.data[n].id){d=!0;break}if(d){e.city_id=a;return}}e.city_id=0,q()}):e.city_id=0}),g(()=>e.city_id,i=>{i?L(e.city_id).then(t=>{m.district=t.data;const a=e.district_id;if(a){let d=!1;for(let n=0;n<t.data.length;n++)if(a==t.data[n].id){d=!0;break}if(d){e.district_id=a;return}}q(),e.district_id=0}):e.district_id=0}),g(()=>e.district_id,i=>{i&&q()});const q=le(()=>{setTimeout(()=>{const i=[e.province_id?k.value.states.selectedLabel:"",e.city_id?x.value.states.selectedLabel:"",e.district_id?P.value.states.selectedLabel:""];Le({mapKey:T,address:i.join("")}).then(({message:t,result:a})=>{if(t=="Success"||t=="query ok"){const d=new window.TMap.LatLng(a.location.lat,a.location.lng);v.setCenter(d),C.updateGeometries({id:"center",position:d}),e.latitude=a.location.lat,e.longitude=a.location.lng}else console.error(t,a)})},500)},500);g(()=>u.province_id,i=>{i&&L(u.province_id).then(t=>{m.city=t.data,e.province_id=u.province_id,e.city_id=u.city_id})}),g(()=>u.city_id,i=>{i&&L(u.city_id).then(t=>{m.district=t.data,e.city_id=u.city_id,e.district_id=u.district_id})}),g(()=>u.district_id,i=>{i&&(e.district_id=u.district_id)});const J=async i=>{f.value||!i||await i.validate(async t=>{if(t){f.value=!0;const a=e;e.province_name=e.province_id?k.value.states.selectedLabel:"",e.city_name=e.city_id?x.value.states.selectedLabel:"",e.district_name=e.district_id?P.value.states.selectedLabel:"";const d=[a.province_id?k.value.states.selectedLabel:"",a.city_id?x.value.states.selectedLabel:"",a.district_id?P.value.states.selectedLabel:"",a.address];a.full_address=d.join(""),(V?be:ye)(a).then(p=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},K=()=>{history.back()};return(i,t)=>{const a=re,d=de,n=se,p=ne,Y=fe,b=ce,R=ue,W=me,O=pe,z=_e;return _(),M("div",we,[r(d,{class:"card !border-none mb-[15px]",shadow:"never"},{default:c(()=>[r(a,{content:s(V)?s(o)("updateStore"):s(o)("addStore"),icon:i.ArrowLeft,onBack:K},null,8,["content","icon"])]),_:1}),G((_(),E(d,{class:"box-card !border-none",shadow:"never"},{default:c(()=>[r(W,{model:e,"label-width":"140px",ref_key:"formRef",ref:I,rules:s(H),class:"page-form"},{default:c(()=>[r(p,{label:s(o)("storeName"),prop:"store_name"},{default:c(()=>[r(n,{modelValue:e.store_name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.store_name=l),modelModifiers:{trim:!0},clearable:"",placeholder:s(o)("storeNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(p,{label:s(o)("storeDesc")},{default:c(()=>[r(n,{modelValue:e.store_desc,"onUpdate:modelValue":t[1]||(t[1]=l=>e.store_desc=l),modelModifiers:{trim:!0},type:"textarea",rows:"4",clearable:"",placeholder:s(o)("storeDescPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(p,{label:s(o)("storeLogo")},{default:c(()=>[r(Y,{modelValue:e.store_logo,"onUpdate:modelValue":t[2]||(t[2]=l=>e.store_logo=l)},null,8,["modelValue"])]),_:1},8,["label"]),r(p,{label:s(o)("storeMobile"),prop:"store_mobile"},{default:c(()=>[r(n,{modelValue:e.store_mobile,"onUpdate:modelValue":t[3]||(t[3]=l=>e.store_mobile=l),modelModifiers:{trim:!0},clearable:"",placeholder:s(o)("storeMobilePlaceholder"),class:"input-width",onKeyup:t[4]||(t[4]=l=>s(oe)(l)),onBlur:t[5]||(t[5]=l=>e.store_mobile=l.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(p,{label:s(o)("tradeTime"),prop:"trade_time"},{default:c(()=>[w("div",null,[r(n,{modelValue:e.trade_time,"onUpdate:modelValue":t[6]||(t[6]=l=>e.trade_time=l),modelModifiers:{trim:!0},clearable:"",placeholder:s(o)("tradeTimePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),w("p",Ve,U(s(o)("tradeTimeTips")),1)])]),_:1},8,["label"]),r(p,{label:s(o)("storeAddress"),prop:"address_area"},{default:c(()=>[r(R,{modelValue:e.province_id,"onUpdate:modelValue":t[7]||(t[7]=l=>e.province_id=l),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:k},{default:c(()=>[r(b,{label:s(o)("provincePlaceholder"),value:0},null,8,["label"]),(_(!0),M(B,null,D(m.province,(l,h)=>(_(),E(b,{key:h,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(R,{modelValue:e.city_id,"onUpdate:modelValue":t[8]||(t[8]=l=>e.city_id=l),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:x},{default:c(()=>[r(b,{label:s(o)("cityPlaceholder"),value:0},null,8,["label"]),(_(!0),M(B,null,D(m.city,(l,h)=>(_(),E(b,{key:h,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(R,{modelValue:e.district_id,"onUpdate:modelValue":t[9]||(t[9]=l=>e.district_id=l),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:P},{default:c(()=>[r(b,{label:s(o)("districtPlaceholder"),value:0},null,8,["label"]),(_(!0),M(B,null,D(m.district,(l,h)=>(_(),E(b,{key:h,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(p,{prop:"address"},{default:c(()=>[r(n,{modelValue:e.address,"onUpdate:modelValue":t[10]||(t[10]=l=>e.address=l),modelModifiers:{trim:!0},clearable:"",placeholder:s(o)("addressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),r(p,null,{default:c(()=>[G(w("div",ke,null,512),[[z,N.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[z,f.value]]),w("div",xe,[w("div",Pe,[r(O,{type:"primary",onClick:t[11]||(t[11]=l=>J(I.value))},{default:c(()=>[Q(U(s(o)("save")),1)]),_:1}),r(O,{onClick:t[12]||(t[12]=l=>K())},{default:c(()=>[Q(U(s(o)("cancel")),1)]),_:1})])])])}}});export{pt as default};
