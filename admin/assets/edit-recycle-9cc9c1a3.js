import{d as G,r as y,q as h,h as _,v as R,w as l,e as a,a as c,i,C as U,c as w,F as I,T as K,U as X,K as z,L as A,aS as H,E as J,M as Q,ax as W,at as Y,au as Z,aE as ee,ay as ae,X as te,p as le,g as re}from"./index-0e396751.js";/* empty css                  *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                 *//* empty css                *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";import{u as oe,a as se,b as me,c as ie,d as ne}from"./site-368fa7aa.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const f=b=>(le("data-v-cf98291c"),b=b(),re(),b),de=f(()=>c("div",{class:"text-gray-400 text-sm mt-1"},'提示：请按照"省份-城市"的格式填写，例如：河北-石家庄',-1)),ue={class:"flex justify-center mt-4"},pe=f(()=>c("span",{class:"ml-2"},"元",-1)),_e=f(()=>c("span",{class:"mx-2"},"至",-1)),fe=f(()=>c("span",{class:"mx-2"},"加价比例",-1)),be=f(()=>c("span",{class:"ml-2"},"元",-1)),ge={class:"flex justify-center mt-4"},ye=G({__name:"edit-recycle",emits:["success"],setup(b,{expose:P,emit:E}){const d=y(!1),V=y("basic"),k=y(),v=y(),r=h({id:"",contact_name:"",contact_mobile:"",area:"",address:"",category:"",status:1}),o=h({id:"",recycler_id:"",price_type:1,member_markup:0,non_member_markup:0,price_ranges:[{min_price:0,max_price:0,member_markup:0}]}),B={contact_name:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contact_mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],area:[{required:!0,message:"请输入所在地区",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5]+-[\u4e00-\u9fa5]+$/,message:'请按照"省份-城市"的格式填写，例如：河北-石家庄',trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],category:[{required:!0,message:"请选择经营品类",trigger:"blur"}]},j={price_type:[{required:!0,message:"请选择加价类型",trigger:"change"}],member_markup:[{required:!0,message:"请输入会员加价比例",trigger:"blur"}],non_member_markup:[{required:!0,message:"请输入非会员加价比例",trigger:"blur"}]},D=()=>{o.price_ranges.push({min_price:0,max_price:0,member_markup:0})},N=s=>{o.price_ranges.splice(s,1)},S=async()=>{k.value&&await k.value.validate(async s=>{if(s)try{const e={...r};if(r.id)await oe(e);else{const n=await se(e);r.id=n.data}X.success("保存基本信息成功"),E("success"),e.id||(V.value="price")}catch(e){console.error("保存基本信息失败:",e)}})},T=async()=>{v.value&&await v.value.validate(async s=>{if(s)try{const e={...o,recycler_id:r.id};o.id?await me(e):await ie(e),E("success"),d.value=!1}catch(e){console.error("保存价格配置失败:",e)}})};return P({showDialog:d,setFormData:async(s=null)=>{if(s){Object.assign(r,s);try{const e=await ne(s.id);console.log(e),e.data&&(o.id=e.data.id,o.price_type=e.data.price_type,o.member_markup=e.data.member_markup,o.non_member_markup=e.data.non_member_markup,e.data.price_ranges&&(o.price_ranges=e.data.price_ranges))}catch(e){console.error("获取价格配置失败:",e)}}else Object.assign(r,{id:"",contact_name:"",contact_mobile:"",area:"",address:"",category:"",status:1}),Object.assign(o,{id:"",recycler_id:"",price_type:1,member_markup:0,non_member_markup:0,price_ranges:[{min_price:0,max_price:0,member_markup:0}]})}}),(s,e)=>{const n=z,m=A,$=H,u=J,F=Q,C=W,q=Y,O=Z,g=ee,L=ae,M=te;return _(),R(M,{modelValue:d.value,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value=t),title:r.id?"编辑回收商信息":"添加回收商信息",width:"50%"},{default:l(()=>[a(L,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value=t)},{default:l(()=>[a(C,{label:"基本信息",name:"basic"},{default:l(()=>[a(F,{model:r,"label-width":"120px",ref_key:"basicFormRef",ref:k,rules:B,class:"page-form"},{default:l(()=>[a(m,{label:"联系人",prop:"contact_name"},{default:l(()=>[a(n,{modelValue:r.contact_name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.contact_name=t),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),a(m,{label:"联系电话",prop:"contact_mobile"},{default:l(()=>[a(n,{modelValue:r.contact_mobile,"onUpdate:modelValue":e[1]||(e[1]=t=>r.contact_mobile=t),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(m,{label:"所在地区",prop:"area"},{default:l(()=>[a(n,{modelValue:r.area,"onUpdate:modelValue":e[2]||(e[2]=t=>r.area=t),placeholder:"请输入地区，格式：河北-石家庄"},null,8,["modelValue"]),de]),_:1}),a(m,{label:"详细地址",prop:"address"},{default:l(()=>[a(n,{modelValue:r.address,"onUpdate:modelValue":e[3]||(e[3]=t=>r.address=t),type:"textarea",placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),a(m,{label:"经营品类",prop:"category"},{default:l(()=>[a(n,{modelValue:r.category,"onUpdate:modelValue":e[4]||(e[4]=t=>r.category=t),placeholder:"请输入经营品类，格式：1,2,3"},null,8,["modelValue"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:l(()=>[a($,{modelValue:r.status,"onUpdate:modelValue":e[5]||(e[5]=t=>r.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),c("div",ue,[a(u,{onClick:e[6]||(e[6]=t=>d.value=!1)},{default:l(()=>[i("取消")]),_:1}),a(u,{type:"primary",onClick:S},{default:l(()=>[i("保存基本信息")]),_:1})])]),_:1},8,["model"])]),_:1}),a(C,{label:"价格配置",name:"price",disabled:!r.id},{default:l(()=>[a(F,{model:o,"label-width":"120px",ref_key:"priceFormRef",ref:v,rules:j,class:"page-form"},{default:l(()=>[a(m,{label:"加价类型",prop:"price_type"},{default:l(()=>[a(O,{modelValue:o.price_type,"onUpdate:modelValue":e[7]||(e[7]=t=>o.price_type=t)},{default:l(()=>[a(q,{label:1},{default:l(()=>[i("统一加价")]),_:1}),a(q,{label:2},{default:l(()=>[i("区间加价")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.price_type===1?(_(),R(m,{key:0,label:"加价金额",prop:"member_markup"},{default:l(()=>[a(g,{modelValue:o.member_markup,"onUpdate:modelValue":e[8]||(e[8]=t=>o.member_markup=t),min:0,max:1e3},null,8,["modelValue"]),pe]),_:1})):U("",!0),o.price_type===2?(_(),w(I,{key:1},[(_(!0),w(I,null,K(o.price_ranges,(t,x)=>(_(),w("div",{key:x,class:"price-range-item"},[a(m,{label:"价格区间"+(x+1)},{default:l(()=>[a(g,{modelValue:t.min_price,"onUpdate:modelValue":p=>t.min_price=p,min:0,placeholder:"最小价格"},null,8,["modelValue","onUpdate:modelValue"]),_e,a(g,{modelValue:t.max_price,"onUpdate:modelValue":p=>t.max_price=p,min:0,placeholder:"最大价格"},null,8,["modelValue","onUpdate:modelValue"]),fe,a(g,{modelValue:t.member_markup,"onUpdate:modelValue":p=>t.member_markup=p,min:0,max:1e3,step:1},null,8,["modelValue","onUpdate:modelValue"]),be,o.price_ranges.length>1?(_(),R(u,{key:0,type:"danger",link:"",onClick:p=>N(x)},{default:l(()=>[i(" 删除 ")]),_:2},1032,["onClick"])):U("",!0)]),_:2},1032,["label"])]))),128)),a(u,{type:"primary",onClick:D},{default:l(()=>[i("添加价格区间")]),_:1})],64)):U("",!0),c("div",ge,[a(u,{onClick:e[9]||(e[9]=t=>d.value=!1)},{default:l(()=>[i("取消")]),_:1}),a(u,{type:"primary",onClick:T},{default:l(()=>[i("保存价格配置")]),_:1})])]),_:1},8,["model"])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});const je=ce(ye,[["__scopeId","data-v-cf98291c"]]);export{je as default};
