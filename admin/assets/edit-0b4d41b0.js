import{d as xe,f as Ve,x as ke,r as q,n as oe,l as je,q as e,h as g,c as S,e as a,w as l,u as o,aQ as Te,R as Ue,s as k,a as n,i as V,t as u,B as j,F as D,T as J,A as te,U as P,aJ as A,aR as we,a7 as Se,K as Ne,L as Ee,bR as Ie,au as Pe,av as Ce,aw as Me,ad as Ge,E as qe,ae as Be,J as Oe,ac as Re,aD as $e,M as Le,Y as De,p as Je,g as Ae}from"./index-904cb7a2.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                        *//* empty css                       *//* empty css                 *//* empty css                       */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{_ as $}from"./goods_default-664bb559.js";import{T as Fe,U as Ze,V as ze,W as He}from"./marketing-fa4978d8.js";import{B as Ke,A as Qe}from"./member-49c3e5fc.js";import se from"./goods-select-popup-f394e385.js";import We from"./coupon-select-popup-e707d9b8.js";import{_ as Ye}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                      *//* empty css                          */import"./goods-6bf0c95b.js";const C=O=>(Je("data-v-e77c6f54"),O=O(),Ae(),O),Xe={class:"main-container"},eo={class:"w-[180px]"},oo={key:0,class:"ml-[120px] mb-[10px] mt-[-10px] text-[12px] text-[#999] leading-[20px]"},to={key:1,class:"ml-[120px] mb-[10px] mt-[-10px] text-[12px] text-[#999] leading-[20px]"},so={class:"el-form-item__content"},lo={class:"level-header"},ao={class:"font-bold text-[#333]"},io=["onClick"],no={class:"level-section flex"},ro={class:"flex items-center ml-[10px]"},uo=C(()=>n("span",{class:"mr-[10px]"},"满",-1)),_o={class:"ml-[10px]"},po={class:"level-section"},mo={class:"vertical-checkbox-group"},co={class:"condition-item"},go={key:0,class:"dynamic-content"},fo={class:"flex items-center"},bo={class:"mr-[10px]"},ho={class:"ml-[10px]"},yo={class:"condition-item"},vo={class:"mt-[-10px] text-[#999] text-[12px]"},xo={class:"condition-item"},Vo={class:"dynamic-content flex items-center"},ko=C(()=>n("span",{class:"mr-[10px]"},"送",-1)),jo=C(()=>n("span",{class:"ml-[10px]"},"积分",-1)),To={class:"condition-item"},Uo={class:"dynamic-content flex items-center"},wo=C(()=>n("span",{class:"mr-[10px]"},"送",-1)),So=C(()=>n("span",{class:"ml-[10px]"},"余额",-1)),No={class:"condition-item"},Eo={class:"mt-[-10px] text-[#999] text-[12px]"},Io={class:"w-full sku_list"},Po={class:"condition-item"},Co={class:"mt-[-10px] text-[#999] text-[12px]"},Mo={class:"w-full sku_list"},Go={class:"flex items-center cursor-pointer"},qo={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Bo=C(()=>n("div",{class:"image-slot"},[n("img",{class:"w-[60px] h-[60px]",src:$})],-1)),Oo={key:1,class:"w-[70px] h-[60px]",src:$,fit:"contain"},Ro={class:"ml-2"},$o=["title"],Lo={class:"text-primary text-[12px]"},Do={class:"flex items-center cursor-pointer"},Jo={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Ao=C(()=>n("div",{class:"image-slot"},[n("img",{class:"w-[60px] h-[60px]",src:$})],-1)),Fo={key:1,class:"w-[70px] h-[60px]",src:$,fit:"contain"},Zo={class:"ml-2"},zo=["title"],Ho={class:"text-primary text-[12px]"},Ko={key:0,class:"text-red-500 text-sm ml-[10px] mt-5"},Qo={key:1,class:"text-red-500 text-sm ml-[10px] mt-5"},Wo={class:"fixed-footer-wrap"},Yo={class:"fixed-footer"},Xo=xe({__name:"edit",setup(O){const le=Ve(),F=ke();F.meta.title;const E=F.query.id,Z=new Date,z=new Date(new Date().setMinutes(new Date().getMinutes()+10)),N=q(!1),H=q(null),ae=oe({manjian_name:"",start_time:"",goods_type:"all_goods",condition_type:"over_n_yuan",rule_type:"ladder",join_member_type:"all_member",end_time:"",goods_data:[],goods_ids:[],rule_json:[{limit:"",is_discount:!1,is_free_shipping:!1,is_give_point:!1,is_give_coupon:!1,is_give_goods:!1,is_give_balance:!1,discount_type:1,discount_money:"",point:"",balance:"",goods_ids:[],goods:[],couponIds:[],coupon:[]}],manjian_time:[Z,z]}),t=oe({...ae}),K=q(),ie=je(()=>({manjian_name:[{required:!0,message:e("namePlaceholder"),trigger:"blur"}],manjian_time:[{required:!0,validator:de,trigger:"change"}],goods_data:[{required:!0,trigger:"blur",validator:(r,m,f)=>{t.goods_type!="all_goods"&&(t.goods_data.length==0?f(new Error(e("goodsJsonEmpty"))):f())}}]})),de=(b,r,m)=>{!t.manjian_time||t.manjian_time&&!t.manjian_time[0]&&!t.manjian_time[1]?m(new Error(e("selectActivityTime"))):t.manjian_time[0]?t.manjian_time[1]?t.manjian_time[1]<=t.manjian_time[0]&&m(new Error(e("selectActivityTimeTips"))):m(new Error(e("selectActivityEndTime"))):m(new Error(e("selectActivityStartTime"))),m()},ne=()=>{if(t.rule_json.length>=5){P.error(e("addLevelLimit"));return}t.rule_json.push({limit:"",is_discount:!1,is_free_shipping:!1,is_give_point:!1,is_give_coupon:!1,is_give_goods:!1,is_give_balance:!1,discount_type:1,discount_money:"",point:"",balance:"",goods_ids:[],goods:[],couponIds:[],coupon:[]})},I={required:/[\S]+/,number:/^\d{0,10}$/,digit:/^\d{0,10}(.?\d{0,2})$/,special:/^\d{0,10}(.?\d{0,3})$/},re=b=>{t.rule_json.splice(b,1)},Q=q([]),W=q([]),v=q(!1);(()=>{Ke().then(({data:b})=>{W.value=b}),Qe().then(({data:b})=>{Q.value=b}),E&&(v.value=!0,N.value=!0,Fe({manjian_id:E}).then(r=>{const m=r.data.manjian_info;t.goods_data=r.data.manjian_goods,t.goods_ids.splice(0,t.goods_ids.length),t.goods_data.forEach(f=>{t.goods_ids.push(f.sku_id)}),Object.assign(t,m),t.manjian_time=[m.start_time,m.end_time],N.value=!1}))})();const ue=(b,r)=>{t.goods_data.splice(r,1),t.goods_ids.splice(t.goods_ids.indexOf(b.sku_id),1)},_e=(b,r)=>{const m=t.rule_json[r],f=m.goods.findIndex(d=>d.sku_id===b.sku_id);f!==-1&&m.goods.splice(f,1);const _=m.goods_ids.indexOf(b.sku_id);_!==-1&&m.goods_ids.splice(_,1)},pe=(b,r)=>{const m=t.rule_json[r],f=m.coupon.findIndex(d=>d.coupon_id===b.coupon_id);f!==-1&&m.coupon.splice(f,1);const _=m.couponIds.indexOf(b.coupon_id);f!==-1&&m.couponIds.splice(_,1)},me=b=>{let r=[];for(let f in b){let _=b[f],d={goods_id:_.goods_id,sku_id:_.sku_id,goods_type_name:_.goods_type_name,price:_.price,sku_image:_.sku_image,goods_name:_.goods_name,sku_name:_.sku_name,stock:_.stock};t.goods_data.length&&t.goods_data.forEach(h=>{h.sku_id==d.sku_id&&(d=Object.assign(d,h))}),r.push(A(d))}t.goods_data=r;let m={manjian_id:E?Number(E):"",goods_ids:t.goods_data.map(f=>f.goods_id),goods_type:t.goods_type,start_time:t.manjian_time[0]?t.manjian_time[0]:Z,end_time:t.manjian_time[1]?t.manjian_time[1]:z};Ze(m).then(f=>{f.data.code==-1&&P({message:e("goodOnlyOne"),type:"error"});const _=f.data.data;t.goods_data.forEach(d=>{const h=_.find(y=>y.goods_id===d.goods_id);h&&(d.error_msg=h.error_msg)})})},ce=(b,r)=>{const m=t.rule_json[r];let f=[];for(let _ in b){let d=b[_],h={goods_id:d.goods_id,sku_id:d.sku_id,goods_type_name:d.goods_type_name,price:d.price,sku_image:d.sku_image,goods_name:d.goods_name,sku_name:d.sku_name,stock:d.stock,num:1};m.goods.length&&m.goods.forEach(y=>{y.sku_id==h.sku_id&&(h=Object.assign(h,y))}),f.push(A(h))}m.goods=f},ge=(b,r)=>{const m=t.rule_json[r];let f=[];for(let _ in b){let d=b[_],h={price:d.price,title:d.title,type_name:d.type_name,coupon_id:d.id,num:1};m.coupon.length&&m.coupon.forEach(y=>{y.coupon_id==h.coupon_id&&(h=Object.assign(h,y))}),f.push(A(h))}m.coupon=f},fe=async()=>{var f;const b=JSON.parse(JSON.stringify(t.rule_json)),r=JSON.parse(JSON.stringify(t.goods_data));t.rule_json.some((_,d)=>!_.is_discount&&!_.is_free_shipping&&!_.is_give_point&&!_.is_give_coupon&&!_.is_give_goods&&!_.is_give_balance?(P.error(e(`第 ${d+1} 层级的优惠内容至少选择一项`)),!0):!1)||await((f=K.value)==null?void 0:f.validate(async _=>{if(_)N.value=!0,t.start_time=t.manjian_time[0],t.end_time=t.manjian_time[1],t.rule_json.forEach(h=>{h.goods&&(h.goods=h.goods.map(y=>({...y,num:y.num}))),h.coupon&&(h.coupon=h.coupon.map(y=>({...y,num:y.num})))}),E?(t.id=E,ze(t).then(h=>{h.data.code==1?(N.value=!1,R(),P({message:e("updateSuccess"),type:"success"})):(N.value=!1,P({message:e("goodOnlyOne"),type:"error"}))}).catch(()=>{t.rule_json=b,t.goods_data=r,N.value=!1})):He(t).then(h=>{h.data.code==1?(N.value=!1,R(),P({message:e("addSuccess"),type:"success"})):(N.value=!1,P({message:e("goodOnlyOne"),type:"error"}))}).catch(()=>{t.rule_json=b,t.goods_data=r,N.value=!1});else{var d=document.getElementsByClassName("is-error")[0];d.scrollIntoView()}}))},R=()=>{le.push("/shop/marketing/manjian/list")};return(b,r)=>{const m=we,f=Se,_=Ne,d=Ee,h=Ie,y=Pe,B=Ce,M=Me,U=Ge,G=qe,L=Be,Y=Oe,X=Re,ee=$e,be=Le,he=De;return g(),S("div",Xe,[a(f,{class:"card !border-none",shadow:"never"},{default:l(()=>[a(m,{content:o(E)?o(e)("editFullDiscountBonus"):o(e)("addFullDiscountBonus"),icon:o(Te),onBack:r[0]||(r[0]=s=>R())},null,8,["content","icon"])]),_:1}),Ue((g(),k(f,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:l(()=>[a(be,{model:t,"label-width":"120px",ref_key:"formRef",ref:K,rules:o(ie),"scroll-to-error":"",class:"page-form"},{default:l(()=>[a(d,{label:o(e)("activeName"),prop:"manjian_name"},{default:l(()=>[n("div",null,[a(_,{modelValue:t.manjian_name,"onUpdate:modelValue":r[1]||(r[1]=s=>t.manjian_name=s),modelModifiers:{trim:!0},clearable:"",placeholder:o(e)("namePlaceholder"),class:"input-width",maxlength:20,"show-word-limit":""},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),a(d,{label:o(e)("activityTime"),prop:"manjian_time"},{default:l(()=>[n("div",eo,[a(h,{modelValue:t.manjian_time,"onUpdate:modelValue":r[2]||(r[2]=s=>t.manjian_time=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])]),_:1},8,["label"]),a(d,{label:o(e)("conditionType"),prop:"condition_type",required:""},{default:l(()=>[a(B,{modelValue:t.condition_type,"onUpdate:modelValue":r[3]||(r[3]=s=>t.condition_type=s),disabled:v.value},{default:l(()=>[a(y,{label:"over_n_yuan"},{default:l(()=>[V(u(o(e)("overNyuan")),1)]),_:1}),a(y,{label:"over_n_piece"},{default:l(()=>[V(u(o(e)("overNgoods")),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),a(d,{label:o(e)("ruleType"),prop:"rule_type",required:""},{default:l(()=>[a(B,{modelValue:t.rule_type,"onUpdate:modelValue":r[4]||(r[4]=s=>t.rule_type=s),disabled:v.value},{default:l(()=>[a(y,{label:"ladder"},{default:l(()=>[V(u(o(e)("ladder")),1)]),_:1}),a(y,{label:"cycle"},{default:l(()=>[V(u(o(e)("cycle")),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),t.rule_type==="ladder"?(g(),S("div",oo,u(o(e)("ruleTypeTips")),1)):j("",!0),t.rule_type==="cycle"?(g(),S("div",to,u(o(e)("ruleTypeTipsTwo")),1)):j("",!0),a(d,{label:o(e)("ruleJson"),prop:"rule_json",class:"",required:""},{default:l(()=>[n("div",so,[(g(!0),S(D,null,J(t.rule_type==="cycle"?[t.rule_json[0]]:t.rule_json,(s,x)=>(g(),S("div",{key:x,class:"activity-level"},[n("div",lo,[n("div",ao,u(o(e)("activityLevel"))+u(x+1),1),t.rule_json.length>1&&x!==0&&!v.value?(g(),S("span",{key:0,class:"cursor-pointer text-primary mr-[10px]",onClick:i=>re(x)},u(o(e)("delete")),9,io)):j("",!0)]),n("div",no,[a(d,{class:"limit-input",label:o(e)("discountThreshold"),prop:`rule_json.${x}.limit`,rules:[{required:!0,trigger:"blur",validator:(i,p,c)=>{var T;if(p===null||p==="")c(o(e)("limitPlaceholder"));else if(isNaN(p)||!I.digit.test(p)&&t.condition_type=="over_n_yuan")c(o(e)("limitTips"));else if(isNaN(p)||!I.number.test(p)&&t.condition_type=="over_n_piece")c(o(e)("limitTips"));else if(p<=0)c(o(e)("valueMustBeGreaterThanZero"));else{const w=(T=t.rule_json[x-1])==null?void 0:T.limit;w!==void 0&&p<=Number(w)?c(o(e)("limitTipsThree")):t.rule_json.map((ye,ve)=>ve!==x&&ye.limit).includes(p)?c(o(e)("limitTipsTwo")):c()}}}]},{default:l(()=>[n("div",ro,[uo,a(_,{clearable:"",class:"input-width-short",maxlength:"8",modelValue:s.limit,"onUpdate:modelValue":i=>s.limit=i,placeholder:t.condition_type==="over_n_yuan"?"0.00":"0",disabled:v.value},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),n("span",_o,u(t.condition_type==="over_n_yuan"?"元":"件"),1)])]),_:2},1032,["label","prop","rules"])]),n("div",po,[a(d,{class:"limit-input",label:o(e)("discountContent"),required:""},{default:l(()=>[n("div",mo,[n("div",co,[a(M,{modelValue:s.is_discount,"onUpdate:modelValue":i=>s.is_discount=i,disabled:v.value,label:"is_discount"},{default:l(()=>[V(u(o(e)("discountMoney")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),a(d,{class:"limit-input"},{default:l(()=>[s.is_discount?(g(),S("div",go,[t.rule_type=="ladder"?(g(),k(B,{key:0,modelValue:s.discount_type,"onUpdate:modelValue":i=>s.discount_type=i,disabled:v.value},{default:l(()=>[a(y,{label:1},{default:l(()=>[V(u(o(e)("reduce")),1)]),_:1}),a(y,{label:2},{default:l(()=>[V(u(o(e)("discountRate")),1)]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):j("",!0),a(d,{prop:`rule_json.${x}.discount_money`,rules:[{required:!0,trigger:"blur",validator:(i,p,c)=>{p===null||p===""?c(o(e)("discountsPlaceholder")):isNaN(p)||!I.digit.test(p)?c(o(e)("limitTips")):p<=0?c(o(e)("discountMustBeGreaterThanZero")):s.discount_type===1&&t.condition_type=="over_n_yuan"&&p>Number(s.limit)?c(o(e)("discountLimit")):s.discount_type===2&&(p>9.9||p<.1)?c(o(e)("discountMustBeGreaterThanNine")):c()}}]},{default:l(()=>[n("div",fo,[n("span",bo,u(s.discount_type===1?"减":"打"),1),s.discount_type===1?(g(),k(_,{key:0,disabled:v.value,clearable:"",class:"input-width-short",maxlength:"8",modelValue:s.discount_money,"onUpdate:modelValue":i=>s.discount_money=i,placeholder:"0.00"},null,8,["disabled","modelValue","onUpdate:modelValue"])):(g(),k(_,{key:1,disabled:v.value,modelValue:s.discount_money,"onUpdate:modelValue":i=>s.discount_money=i,clearable:"",class:"input-width-short",maxlength:"8",max:9.9,placeholder:"0.00"},null,8,["disabled","modelValue","onUpdate:modelValue","max"])),n("span",ho,u(s.discount_type===1?"元":"折"),1)])]),_:2},1032,["prop","rules"])])):j("",!0)]),_:2},1024)]),n("div",yo,[a(M,{modelValue:s.is_free_shipping,"onUpdate:modelValue":i=>s.is_free_shipping=i,disabled:v.value,label:"is_free_shipping"},{default:l(()=>[V(u(o(e)("freeShipping")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),n("div",vo,u(o(e)("freeTips")),1)]),n("div",xo,[a(M,{disabled:v.value,modelValue:s.is_give_point,"onUpdate:modelValue":i=>s.is_give_point=i,label:"is_give_point"},{default:l(()=>[V(u(o(e)("givePoint")),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),s.is_give_point?(g(),k(d,{key:0,class:"limit-input",prop:`rule_json.${x}.point`,rules:[{required:!0,trigger:"blur",validator:(i,p,c)=>{p===null||p===""?c(o(e)("pointPlaceholder")):isNaN(p)||!I.number.test(p)?c(o(e)("limitTips")):p<=0?c(o(e)("pointMustBeGreaterThanZero")):c()}}]},{default:l(()=>[n("div",Vo,[ko,a(_,{disabled:v.value,clearable:"",class:"input-width-short",maxlength:"8",modelValue:s.point,"onUpdate:modelValue":i=>s.point=i,placeholder:"0"},null,8,["disabled","modelValue","onUpdate:modelValue"]),jo])]),_:2},1032,["prop","rules"])):j("",!0)]),n("div",To,[a(M,{disabled:v.value,modelValue:s.is_give_balance,"onUpdate:modelValue":i=>s.is_give_balance=i,label:"is_give_balance"},{default:l(()=>[V(u(o(e)("giveBalance")),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),s.is_give_balance?(g(),k(d,{key:0,class:"limit-input",prop:`rule_json.${x}.balance`,rules:[{required:!0,trigger:"blur",validator:(i,p,c)=>{p===null||p===""?c(o(e)("balancePlaceholder")):isNaN(p)||!I.digit.test(p)?c(o(e)("limitTips")):p<=0?c(o(e)("balanceMustBeGreaterThanZero")):c()}}]},{default:l(()=>[n("div",Uo,[wo,a(_,{disabled:v.value,clearable:"",class:"input-width-short",maxlength:"8",modelValue:s.balance,"onUpdate:modelValue":i=>s.balance=i,placeholder:"0.00"},null,8,["disabled","modelValue","onUpdate:modelValue"]),So])]),_:2},1032,["prop","rules"])):j("",!0)]),n("div",No,[a(M,{label:"is_give_coupon",disabled:v.value,modelValue:s.is_give_coupon,"onUpdate:modelValue":i=>s.is_give_coupon=i},{default:l(()=>[V(u(o(e)("giveCoupon")),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),n("div",Eo,u(o(e)("giveCouponTips")),1),s.is_give_coupon&&!v.value?(g(),k(d,{key:0,prop:`rule_json.${x}.coupon`,class:"dynamic-content",rules:[{required:!0,message:o(e)("couponPlaceholder"),trigger:"blur"}]},{default:l(()=>[a(We,{ref_for:!0,ref:"couponSelectPopupRef",onCouponSelect:i=>ge(i,x),modelValue:s.couponIds,"onUpdate:modelValue":i=>s.couponIds=i,min:1,max:10,"is-gift":1},null,8,["onCouponSelect","modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])):j("",!0),s.coupon&&s.coupon.length&&s.is_give_coupon?(g(),k(d,{key:1,class:"mt-[15px]"},{default:l(()=>[n("div",Io,[a(L,{data:s.coupon,size:"large","max-height":"400","row-style":{height:"80px"}},{default:l(()=>[a(U,{prop:"title",label:o(e)("name"),"min-width":"120"},{default:l(({row:i})=>[n("div",null,u(i.title),1)]),_:1},8,["label"]),a(U,{prop:"type_name",label:o(e)("type"),"min-width":"120"},{default:l(({row:i})=>[n("div",null,u(i.type_name),1)]),_:1},8,["label"]),a(U,{prop:"price",label:o(e)("couponPrice"),"min-width":"120"},{default:l(({row:i})=>[n("div",null,"￥"+u(i.price),1)]),_:1},8,["label"]),a(U,{prop:"num",label:o(e)("giveNum"),"min-width":"140"},{default:l(({row:i,$index:p})=>[a(d,{prop:"rule_json["+x+"].coupon["+p+"].num",rules:[{required:!0,trigger:"blur",validator:(c,T,w)=>{T===null||T===""?w(o(e)("giveNumPlaceholder")):isNaN(T)||!I.number.test(T)?w(o(e)("limitTips")):T<=0?w(o(e)("giveNumMustBeGreaterThanZero")):w()}}]},{default:l(()=>[a(_,{disabled:v.value,modelValue:i.num,"onUpdate:modelValue":c=>i.num=c,modelModifiers:{number:!0},class:"w-[70px]",clearable:"",maxlength:"5"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1032,["label"]),a(U,{label:o(e)("operation"),align:"right","min-width":"160"},{default:l(({row:i,$index:p})=>[a(G,{type:"primary",link:"",onClick:c=>pe(i,x),disabled:v.value},{default:l(()=>[V(u(o(e)("delete")),1)]),_:2},1032,["onClick","disabled"])]),_:2},1032,["label"])]),_:2},1032,["data"])])]),_:2},1024)):j("",!0)]),n("div",Po,[a(M,{disabled:v.value,label:"is_give_goods",modelValue:s.is_give_goods,"onUpdate:modelValue":i=>s.is_give_goods=i},{default:l(()=>[V(u(o(e)("giveGoods")),1)]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),n("div",Co,u(o(e)("giveGoodsTips")),1),s.is_give_goods&&!v.value?(g(),k(d,{key:0,prop:`rule_json.${x}.goods`,class:"dynamic-content",rules:[{required:!0,message:o(e)("goodsJsonEmpty"),trigger:"blur"}]},{default:l(()=>[a(se,{ref_for:!0,ref_key:"goodsSelectPopupRef",ref:H,modelValue:s.goods_ids,"onUpdate:modelValue":i=>s.goods_ids=i,mode:"sku",onGoodsSelect:i=>ce(i,x),min:1,max:10,"is-gift":1},null,8,["modelValue","onUpdate:modelValue","onGoodsSelect"])]),_:2},1032,["prop","rules"])):j("",!0),s.goods&&s.goods.length&&s.is_give_goods?(g(),k(d,{key:1,class:"mt-[15px]"},{default:l(()=>[n("div",Mo,[a(L,{data:s.goods,size:"large","max-height":"400"},{default:l(()=>[a(U,{prop:"goods_id",label:o(e)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:l(({row:i})=>[n("div",Go,[n("div",qo,[i.sku_image?(g(),k(Y,{key:0,class:"w-[60px] h-[60px]",src:o(te)(i.sku_image),fit:"contain"},{error:l(()=>[Bo]),_:2},1032,["src"])):(g(),S("img",Oo))]),n("div",Ro,[n("span",{title:i.sku_name,class:"multi-hidden"},u(i.sku_name?i.goods_name+" "+i.sku_name:i.goods_name),9,$o),n("span",Lo,u(i.goods_type_name),1)])])]),_:1},8,["label"]),a(U,{prop:"price",label:o(e)("goodsSelectPopupPrice"),"min-width":"120"},{default:l(({row:i})=>[n("div",null,"￥"+u(i.price),1)]),_:1},8,["label"]),a(U,{prop:"stock",label:o(e)("stock"),"min-width":"120"},{default:l(({row:i})=>[n("div",null,u(i.stock),1)]),_:1},8,["label"]),a(U,{prop:"num",label:o(e)("giveNum"),"min-width":"180"},{default:l(({row:i,$index:p})=>[a(d,{prop:"rule_json["+x+"].goods["+p+"].num",rules:[{required:!0,trigger:"blur",validator:(c,T,w)=>{T===null||T===""?w(o(e)("giveNumPlaceholder")):isNaN(T)||!I.number.test(T)?w(o(e)("limitTips")):T<=0?w(o(e)("giveNumMustBeGreaterThanZero")):T>i.stock?w(o(e)("giveNumMustBeGreaterThanStock")):w()}}]},{default:l(()=>[a(_,{disabled:v.value,modelValue:i.num,"onUpdate:modelValue":c=>i.num=c,modelModifiers:{number:!0},class:"w-[70px]",clearable:""},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:2},1032,["label"]),a(U,{label:o(e)("operation"),align:"right","min-width":"160"},{default:l(({row:i,$index:p})=>[a(G,{type:"primary",link:"",onClick:c=>_e(i,x),disabled:v.value},{default:l(()=>[V(u(o(e)("delete")),1)]),_:2},1032,["onClick","disabled"])]),_:2},1032,["label"])]),_:2},1032,["data"])])]),_:2},1024)):j("",!0)])])]),_:2},1032,["label"])])]))),128)),t.rule_type=="ladder"&&t.rule_json.length<5?(g(),k(G,{key:0,disabled:v.value,type:"primary",plain:"",onClick:ne,class:"mt-[20px]"},{default:l(()=>[V(u(o(e)("addActivityLevel")),1)]),_:1},8,["disabled"])):j("",!0)])]),_:1},8,["label"]),a(d,{label:o(e)("joinMemberType"),prop:"join_member_type",required:""},{default:l(()=>[a(B,{modelValue:t.join_member_type,"onUpdate:modelValue":r[5]||(r[5]=s=>t.join_member_type=s)},{default:l(()=>[a(y,{label:"all_member"},{default:l(()=>[V(u(o(e)("allMember")),1)]),_:1}),a(y,{label:"selected_member_level"},{default:l(()=>[V(u(o(e)("selectedMemberLevel")),1)]),_:1}),a(y,{label:"selected_member_label"},{default:l(()=>[V(u(o(e)("selectedMemberLabel")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t.join_member_type=="selected_member_label"?(g(),k(d,{key:2,label:o(e)("memberLabel"),prop:"label_ids",rules:[{required:!0,message:o(e)("labelTips"),trigger:"blur"}]},{default:l(()=>[a(ee,{modelValue:t.label_ids,"onUpdate:modelValue":r[6]||(r[6]=s=>t.label_ids=s),clearable:"",multiple:"",placeholder:o(e)("memberLabelPlaceholder"),class:"input-width"},{default:l(()=>[(g(!0),S(D,null,J(W.value,(s,x)=>(g(),k(X,{label:s.label_name,value:s.label_id,key:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):j("",!0),t.join_member_type=="selected_member_level"?(g(),k(d,{key:3,label:o(e)("memberLevel"),prop:"level_ids",rules:[{required:!0,message:o(e)("levelTips"),trigger:"blur"}]},{default:l(()=>[a(ee,{modelValue:t.level_ids,"onUpdate:modelValue":r[7]||(r[7]=s=>t.level_ids=s),clearable:"",multiple:"",placeholder:o(e)("memberLevelPlaceholder"),class:"input-width"},{default:l(()=>[(g(!0),S(D,null,J(Q.value,(s,x)=>(g(),k(X,{label:s.level_name,value:s.level_id,key:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):j("",!0),a(d,{label:o(e)("goodsType"),prop:"goods_type",required:""},{default:l(()=>[a(B,{modelValue:t.goods_type,"onUpdate:modelValue":r[8]||(r[8]=s=>t.goods_type=s),disabled:v.value},{default:l(()=>[a(y,{label:"all_goods"},{default:l(()=>[V(u(o(e)("allGoods")),1)]),_:1}),a(y,{label:"selected_goods"},{default:l(()=>[V(u(o(e)("selectedGoods")),1)]),_:1}),a(y,{label:"selected_goods_not"},{default:l(()=>[V(u(o(e)("selectedGoodsNot")),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),t.goods_type!="all_goods"?(g(),k(d,{key:4,label:o(e)("selectGoods"),prop:"goods_data"},{default:l(()=>[a(se,{ref_key:"goodsSelectPopupRef",ref:H,modelValue:t.goods_ids,"onUpdate:modelValue":r[9]||(r[9]=s=>t.goods_ids=s),mode:"sku",onGoodsSelect:me,min:1,max:99},null,8,["modelValue"])]),_:1},8,["label"])):j("",!0),t.goods_data&&t.goods_data.length&&t.goods_type!="all_goods"?(g(),k(d,{key:5,class:"mt-[15px]"},{default:l(()=>[a(L,{data:t.goods_data,size:"large","max-height":"400"},{default:l(()=>[a(U,{prop:"goods_id",label:o(e)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:l(({row:s})=>[n("div",Do,[n("div",Jo,[s.sku_image?(g(),k(Y,{key:0,class:"w-[60px] h-[60px]",src:o(te)(s.sku_image),fit:"contain"},{error:l(()=>[Ao]),_:2},1032,["src"])):(g(),S("img",Fo))]),n("div",Zo,[n("span",{title:s.sku_name,class:"multi-hidden"},u(s.sku_name?s.goods_name+" "+s.sku_name:s.goods_name),9,zo),n("span",Ho,u(s.goods_type_name),1)]),s.error_msg?(g(),S("div",Ko,u(s.error_msg),1)):j("",!0),s.status==0?(g(),S("div",Qo,u(o(e)("goodsOffTips")),1)):j("",!0)])]),_:1},8,["label"]),a(U,{prop:"price",label:o(e)("goodsSelectPopupPrice"),"min-width":"120"},{default:l(({row:s})=>[n("div",null,"￥"+u(s.price),1)]),_:1},8,["label"]),a(U,{label:o(e)("operation"),align:"right","min-width":"160"},{default:l(({row:s,$index:x})=>[a(G,{type:"primary",link:"",onClick:i=>ue(s,x)},{default:l(()=>[V(u(o(e)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})):j("",!0),a(d,{label:o(e)("remark"),prop:"remark"},{default:l(()=>[a(_,{modelValue:t.remark,"onUpdate:modelValue":r[10]||(r[10]=s=>t.remark=s),placeholder:o(e)("rankRemarkPlaceholder"),type:"textarea",maxlength:"500","show-word-limit":"",rows:"5",class:"!w-[400px]",clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})),[[he,N.value]]),n("div",Wo,[n("div",Yo,[a(G,{type:"primary",onClick:r[11]||(r[11]=s=>fe())},{default:l(()=>[V(u(o(e)("save")),1)]),_:1}),a(G,{onClick:r[12]||(r[12]=s=>R())},{default:l(()=>[V(u(o(e)("cancel")),1)]),_:1})])])])}}});const qt=Ye(Xo,[["__scopeId","data-v-e77c6f54"]]);export{qt as default};
