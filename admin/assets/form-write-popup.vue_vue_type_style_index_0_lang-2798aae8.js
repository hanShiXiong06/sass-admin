import{d as G,r as g,q as z,m as X,s as m,a2 as Y,h as _,v as b,w as i,a as f,e as o,i as p,t as u,u as r,R as J,c as V,F as C,T as D,C as v,x as R,bU as L,at as Z,au as ee,L as le,ab as te,aC as ie,K as oe,a1 as ae,aU as re,bR as me,bT as _e,M as ne,E as se,X as ue,Y as de}from"./index-0e396751.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                       */import"./el-tooltip-4ed993c7.js";/* empty css               *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 */import{g as pe,a as fe}from"./member-fcb60d7e.js";import{b as be,c as ye}from"./diy_form-e1ce8c59.js";const ce={class:"flex items-center"},ve=f("span",null,"每",-1),we=f("span",null,"可填写",-1),xe=f("span",null,"次",-1),ge={class:"flex items-center"},Ve=f("span",null,"每",-1),Ee=f("span",null,"可填写",-1),Ue=f("span",{class:"mr-[5px]"},"次",-1),ke={class:"w-[250px]"},Ce={key:1,class:"flex items-center mt-[5px]"},De=f("span",{class:"mr-[5px]"},"每天",-1),Le=f("span",{class:"ml-[5px]"},"可填写",-1),Me={class:"dialog-footer"},Ye=G({__name:"form-write-popup",emits:["complete"],setup(he,{expose:B,emit:K}){const w=g(!1),y=g(!1),M={id:0,form_id:0,write_way:"no_limit",join_member_type:"all_member",level_ids:[],label_ids:[],member_write_type:"no_limit",member_write_rule:{time_value:1,time_unit:"day",num:1},form_write_type:"no_limit",form_write_rule:{time_value:1,time_unit:"day",num:1},time_limit_type:"no_limit",time_limit_rule:{specify_time:[],open_day_time:[]},is_allow_update_content:0,write_instruction:""},t=z({...M}),h=g(),N=X(()=>({label_ids:[{required:!0,message:m("labelTips"),trigger:"blur"}],level_ids:[{required:!0,message:m("levelTips"),trigger:"blur"}],member_write_rule:[{validator:(n,e,a)=>{let d="";E.forEach((s,c)=>{s.value==e.time_unit&&(d=s.text)}),t.member_write_type=="diy"?e.time_value?e.num?a():a(new Error("次数不能为空")):a(new Error(`${d}数不能为空`)):a()},trigger:["blur","change"]}],form_write_rule:[{validator:(n,e,a)=>{let d="";E.forEach((s,c)=>{s.value==e.time_unit&&(d=s.text)}),t.member_write_type=="diy"?e.time_value?e.num?a():a(new Error("次数不能为空")):a(new Error(`${d}数不能为空`)):a()},trigger:["blur","change"]}],time_limit_rule:[{validator:(n,e,a)=>{t.time_limit_type=="specify_time"&&(!e.specify_time||!e.specify_time.length)?a(new Error("开始/停止时间不能为空")):t.time_limit_type=="open_day_time"&&(!e.open_day_time||!e.open_day_time.length)?a(new Error("开启时间不能为空")):t.time_limit_type=="open_day_time"&&e.open_day_time&&e.open_day_time.length&&e.open_day_time[0]==e.open_day_time[1]?a(new Error("开始时间不能等于结束时间")):a()},trigger:["blur","change"]}]})),F=g([]),j=g([]);pe().then(({data:n})=>{j.value=n}),fe().then(({data:n})=>{F.value=n});const E=z([{text:"天",value:"day"},{text:"周",value:"week"},{text:"月",value:"month"},{text:"年",value:"year"}]),O=async(n=null)=>{if(Object.assign(t,M),y.value=!0,n){const e=await(await be(n.form_id)).data;e&&Object.keys(e).length?Object.keys(t).forEach(a=>{e[a]!=null&&(t[a]=e[a])}):t.form_id=n.form_id}y.value=!1},P=async n=>{y.value||!n||await n.validate(async e=>{e&&(y.value=!0,ye(t).then(d=>{y.value=!1,w.value=!1,K("complete")}).catch(d=>{y.value=!1}))})};return B({showDialog:w,setFormData:O}),(n,e)=>{const a=Z,d=ee,s=le,c=te,U=ie,k=oe,H=Y("QuestionFilled"),S=ae,$=re,q=me,I=_e,W=ne,T=se,A=ue,Q=de;return _(),b(A,{modelValue:w.value,"onUpdate:modelValue":e[20]||(e[20]=l=>w.value=l),title:r(m)("填写设置"),width:"600px",class:"diy-dialog-wrap","close-on-press-escape":!0,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:i(()=>[f("span",Me,[o(T,{onClick:e[18]||(e[18]=l=>w.value=!1)},{default:i(()=>[p(u(r(m)("cancel")),1)]),_:1}),o(T,{type:"primary",loading:y.value,onClick:e[19]||(e[19]=l=>P(h.value))},{default:i(()=>[p(u(r(m)("confirm")),1)]),_:1},8,["loading"])])]),default:i(()=>[J((_(),b(W,{model:t,"label-width":"120px",ref_key:"formRef",ref:h,rules:r(N),class:"page-form"},{default:i(()=>[o(s,{label:r(m)("joinMemberType")},{default:i(()=>[o(d,{modelValue:t.join_member_type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.join_member_type=l)},{default:i(()=>[o(a,{label:"all_member"},{default:i(()=>[p(u(r(m)("allMember")),1)]),_:1}),o(a,{label:"selected_member_level"},{default:i(()=>[p(u(r(m)("selectedMemberLevel")),1)]),_:1}),o(a,{label:"selected_member_label"},{default:i(()=>[p(u(r(m)("selectedMemberLabel")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t.join_member_type=="selected_member_label"?(_(),b(s,{key:0,label:r(m)("memberLabel"),prop:"label_ids"},{default:i(()=>[o(U,{modelValue:t.label_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>t.label_ids=l),clearable:"",multiple:"",placeholder:r(m)("memberLabelPlaceholder"),class:"input-width"},{default:i(()=>[(_(!0),V(C,null,D(j.value,(l,x)=>(_(),b(c,{label:l.label_name,value:l.label_id,key:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):v("",!0),t.join_member_type=="selected_member_level"?(_(),b(s,{key:1,label:r(m)("memberLevel"),prop:"level_ids"},{default:i(()=>[o(U,{modelValue:t.level_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>t.level_ids=l),clearable:"",multiple:"",placeholder:r(m)("memberLevelPlaceholder"),class:"input-width"},{default:i(()=>[(_(!0),V(C,null,D(F.value,(l,x)=>(_(),b(c,{label:l.level_name,value:l.level_id,key:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):v("",!0),o(s,{label:r(m)("每人可填写次数"),class:R({"!mb-[5px]":t.member_write_type=="diy"})},{default:i(()=>[o(d,{modelValue:t.member_write_type,"onUpdate:modelValue":e[3]||(e[3]=l=>t.member_write_type=l)},{default:i(()=>[o(a,{label:"no_limit"},{default:i(()=>[p(u(r(m)("不限制")),1)]),_:1}),o(a,{label:"diy"},{default:i(()=>[p(u(r(m)("自定义")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","class"]),t.member_write_type=="diy"?(_(),b(s,{key:2,label:" ",prop:"member_write_rule"},{default:i(()=>[f("div",ce,[ve,o(k,{modelValue:t.member_write_rule.time_value,"onUpdate:modelValue":e[4]||(e[4]=l=>t.member_write_rule.time_value=l),modelModifiers:{trim:!0},onKeyup:e[5]||(e[5]=l=>r(L)(l)),size:"small",class:"!w-[50px] px-[5px]",maxlength:"3"},null,8,["modelValue"]),o(U,{modelValue:t.member_write_rule.time_unit,"onUpdate:modelValue":e[6]||(e[6]=l=>t.member_write_rule.time_unit=l),class:"!w-[60px] pr-[5px]",size:"small"},{default:i(()=>[(_(!0),V(C,null,D(E,(l,x)=>(_(),b(c,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),we,o(k,{modelValue:t.member_write_rule.num,"onUpdate:modelValue":e[7]||(e[7]=l=>t.member_write_rule.num=l),modelModifiers:{trim:!0},onKeyup:e[8]||(e[8]=l=>r(L)(l)),size:"small",class:"!w-[50px] px-[5px]",maxlength:"3"},null,8,["modelValue"]),xe])]),_:1})):v("",!0),o(s,{label:r(m)("表单可填写总数"),class:R({"!mb-[5px]":t.form_write_type=="diy"})},{default:i(()=>[o(d,{modelValue:t.form_write_type,"onUpdate:modelValue":e[9]||(e[9]=l=>t.form_write_type=l)},{default:i(()=>[o(a,{label:"no_limit"},{default:i(()=>[p(u(r(m)("不限制")),1)]),_:1}),o(a,{label:"diy"},{default:i(()=>[p(u(r(m)("自定义")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label","class"]),t.form_write_type=="diy"?(_(),b(s,{key:3,label:" ",prop:"form_write_rule"},{default:i(()=>[f("div",ge,[Ve,o(k,{modelValue:t.form_write_rule.time_value,"onUpdate:modelValue":e[10]||(e[10]=l=>t.form_write_rule.time_value=l),modelModifiers:{trim:!0},onKeyup:e[11]||(e[11]=l=>r(L)(l)),size:"small",class:"!w-[50px] px-[5px]",maxlength:"3"},null,8,["modelValue"]),o(U,{modelValue:t.form_write_rule.time_unit,"onUpdate:modelValue":e[12]||(e[12]=l=>t.form_write_rule.time_unit=l),class:"!w-[60px] pr-[5px]",size:"small"},{default:i(()=>[(_(!0),V(C,null,D(E,(l,x)=>(_(),b(c,{key:l.value,label:l.text,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ee,o(k,{modelValue:t.form_write_rule.num,"onUpdate:modelValue":e[13]||(e[13]=l=>t.form_write_rule.num=l),modelModifiers:{trim:!0},onKeyup:e[14]||(e[14]=l=>r(L)(l)),size:"small",class:"!w-[50px] px-[5px]",maxlength:"3"},null,8,["modelValue"]),Ue,o($,{effect:"light",placement:"top"},{content:i(()=>[f("p",ke,u(r(m)("填写限制的校验在极端情况下可能存在延时，从而导致限制失效，不建议商品限时抢购等场景使用该功能")),1)]),default:i(()=>[o(S,null,{default:i(()=>[o(H,{color:"#999999"})]),_:1})]),_:1})])]),_:1})):v("",!0),o(s,{label:r(m)("可填写时间段"),prop:"time_limit_rule"},{default:i(()=>[o(d,{modelValue:t.time_limit_type,"onUpdate:modelValue":e[15]||(e[15]=l=>t.time_limit_type=l)},{default:i(()=>[o(a,{label:"no_limit"},{default:i(()=>[p(u(r(m)("不限制")),1)]),_:1}),o(a,{label:"specify_time"},{default:i(()=>[p(u(r(m)("设置开始/停止时间")),1)]),_:1}),o(a,{label:"open_day_time"},{default:i(()=>[p(u(r(m)("设置每日开启时间")),1)]),_:1})]),_:1},8,["modelValue"]),t.time_limit_type=="specify_time"?(_(),b(q,{key:0,modelValue:t.time_limit_rule.specify_time,"onUpdate:modelValue":e[16]||(e[16]=l=>t.time_limit_rule.specify_time=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])):v("",!0),t.time_limit_type=="open_day_time"?(_(),V("div",Ce,[De,o(I,{class:"!w-[180px]",modelValue:t.time_limit_rule.open_day_time,"onUpdate:modelValue":e[17]||(e[17]=l=>t.time_limit_rule.open_day_time=l),format:"HH:mm","value-format":"HH:mm","is-range":"","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"]),Le])):v("",!0)]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[Q,y.value]])]),_:1},8,["modelValue","title"])}}});export{Ye as _};
