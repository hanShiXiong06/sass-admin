import{d as q,q as E,r as F,aJ as z,h as g,c as x,e as r,w as l,a as u,i as k,t as d,u as i,s as a,v as C,B as K,C as B,R as X,U as f,J as Y,K as H,E as Q,ac as W,ad as ee,X as te,Y as ae,p as oe,g as se}from"./index-0e396751.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                 *//* empty css                        */import{_ as U}from"./goods_default-664bb559.js";import{C as ie,D as le,B as re}from"./goods-4d7d064c.js";import{g as ce}from"./site-368fa7aa.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";const pe=P=>(oe("data-v-33dbae62"),P=P(),se(),P),de={class:"flex items-center mb-[10px]"},me={class:"min-w-[70px] h-[70px] flex items-center justify-center"},ue=pe(()=>u("div",{class:"image-slot"},[u("img",{class:"w-[70px] h-[70px]",src:U})],-1)),_e={key:1,class:"w-[70px] h-[70px]",src:U,fit:"contain"},ge={class:"ml-2"},fe=["title"],ke={class:"text-primary text-[12px]"},ve={key:0,class:"batch-operation-sku"},he={key:0},ye={key:1},be={class:"dialog-footer"},xe=q({__name:"goods-price-edit-popup",emits:["load"],setup(P,{expose:S,emit:D}){const _=E({}),w=F(0),v=F(!1),c=E({loading:!0,data:[]}),s=E({field:"",value:""}),N=(e,t)=>{s.field=e,s.value=""},I=()=>{s.field="",s.value=""},G=()=>{if(s.value.length==0){f({type:"warning",message:`${a(s.field+"Placeholder")}`});return}if(!V.digit.test(s.value)){f({type:"warning",message:`${a(s.field+"Tips")}`});return}if(s.value<0){f({type:"warning",message:`${a(s.field+"NotZeroTips")}`});return}c.data.forEach(e=>{e[s.field]=s.value}),I()},L=()=>{c.loading=!0,re({goods_id:_.goods_id}).then(e=>{c.loading=!1,c.data=e.data}).catch(()=>{c.loading=!1})},R=e=>{Object.assign(_,e),Z(),L(),v.value=!0},Z=()=>{ie({goods_id:_.goods_id}).then(e=>{w.value=e.data})},V={digit:/^\d{0,10}(.?\d{0,2})$/},O=()=>{let e=!0;for(let t=0;t<c.data.length;t++){const n=c.data[t];if(isNaN(n.price)||!V.digit.test(n.price)){e=!1,f({type:"warning",message:`${a("priceTips")}`});break}else if(n.price<0){e=!1,f({type:"warning",message:`${a("priceNotZeroTips")}`});break}if(isNaN(n.market_price)||!V.digit.test(n.market_price)){e=!1,f({type:"warning",message:`${a("marketPriceTips")}`});break}else if(n.market_price<0){e=!1,f({type:"warning",message:`${a("marketPriceNotZeroTips")}`});break}if(isNaN(n.cost_price)||!V.digit.test(n.cost_price)){e=!1,f({type:"warning",message:`${a("costPriceTips")}`});break}else if(n.cost_price<0){e=!1,f({type:"warning",message:`${a("costPriceNotZeroTips")}`});break}}return e},j=()=>{if(O()){let e=[];c.data.forEach(t=>{e.push({sku_id:t.sku_id,price:t.price,market_price:t.market_price,cost_price:t.cost_price})}),le({goods_id:_.goods_id,sku_list:e}).then(t=>{D("load"),v.value=!1})}},y=F(null),A=async()=>{try{const e=await ce({});y.value=e.data}catch(e){console.error("获取价格配置失败:",e)}};z(()=>{A()});const J=e=>{if(!e.market_price||!y.value)return;const t=parseFloat(e.market_price);if(y.value.price_type===1){const p=parseFloat(y.value.member_markup);p?e.price=(t+p).toFixed(2):e.price=t.toFixed(2);return}const m=y.value.price_ranges.find(p=>{const T=parseFloat(p.min_price),$=parseFloat(p.max_price);return t>=T&&t<=$});if(m){const p=parseFloat(m.member_markup);e.price=(t+p).toFixed(2)}else e.price=t.toFixed(2)};return S({showDialog:v,show:R}),(e,t)=>{const n=Y,b=H,m=Q,p=W,T=ee,$=te,M=ae;return g(),x("div",null,[r($,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=o=>v.value=o),title:i(a)("editPricePopupTitle"),width:"800px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:l(()=>[u("span",be,[r(m,{onClick:t[4]||(t[4]=o=>v.value=!1)},{default:l(()=>[k(d(i(a)("cancel")),1)]),_:1}),r(m,{type:"primary",onClick:j},{default:l(()=>[k(d(i(a)("confirm")),1)]),_:1})])]),default:l(()=>[u("div",de,[u("div",me,[_.goods_cover_thumb_small?(g(),C(n,{key:0,class:"w-[70px] h-[70px]",src:i(K)(_.goods_cover_thumb_small),fit:"contain"},{error:l(()=>[ue]),_:1},8,["src"])):(g(),x("img",_e))]),u("div",ge,[u("span",{title:_.goods_name,class:"multi-hidden"},d(_.goods_name),9,fe),u("span",ke,d(_.goods_type_name),1)])]),c.data.length>1?(g(),x("div",ve,[u("label",null,d(i(a)("batchOperationSku")),1),s.field?(g(),x("div",he,[r(b,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),clearable:"",placeholder:i(a)(s.field),class:"set-input",maxlength:"10",autofocus:!0},null,8,["modelValue","placeholder"]),r(m,{type:"primary",onClick:G},{default:l(()=>[k(d(i(a)("confirm")),1)]),_:1}),r(m,{onClick:I},{default:l(()=>[k(d(i(a)("cancel")),1)]),_:1})])):(g(),x("div",ye,[w.value==0?(g(),C(m,{key:0,type:"primary",link:"",onClick:t[1]||(t[1]=o=>N("price"))},{default:l(()=>[k(d(i(a)("price")),1)]),_:1})):B("",!0),r(m,{type:"primary",link:"",onClick:t[2]||(t[2]=o=>N("market_price"))},{default:l(()=>[k(d(i(a)("marketPrice")),1)]),_:1}),r(m,{type:"primary",link:"",onClick:t[3]||(t[3]=o=>N("cost_price"))},{default:l(()=>[k(d(i(a)("costPrice")),1)]),_:1})]))])):B("",!0),X((g(),C(T,{data:c.data,size:"large","max-height":"400"},{empty:l(()=>[u("span",null,d(c.loading?"":i(a)("emptyData")),1)]),default:l(()=>[c.data.length>1?(g(),C(p,{key:0,prop:"sku_name",label:i(a)("skuName"),"min-width":"120"},null,8,["label"])):B("",!0),r(p,{prop:"market_price",label:i(a)("marketPrice"),"min-width":"120"},{default:l(({row:o})=>[r(b,{modelValue:o.market_price,"onUpdate:modelValue":h=>o.market_price=h,clearable:"",placeholder:"0.00",maxlength:"8",onInput:h=>J(o)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["label"]),r(p,{prop:"price",label:i(a)("price"),"min-width":"120"},{default:l(({row:o})=>[r(b,{modelValue:o.price,"onUpdate:modelValue":h=>o.price=h,clearable:"",placeholder:"0.00",maxlength:"8",disabled:w.value>0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1},8,["label"]),r(p,{prop:"cost_price",label:i(a)("costPrice"),"min-width":"120"},{default:l(({row:o})=>[r(b,{modelValue:o.cost_price,"onUpdate:modelValue":h=>o.cost_price=h,clearable:"",placeholder:"0.00",maxlength:"8"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"])]),_:1},8,["data"])),[[M,c.loading]])]),_:1},8,["modelValue","title"])])}}});const je=ne(xe,[["__scopeId","data-v-33dbae62"]]);export{je as default};
