import{d as L,r as m,q,h as p,v as z,w as a,a as l,e as d,i as E,t as i,u as r,s as _,R as K,c as x,C as F,B as W,U as X,a3 as Y,a$ as j,aW as H,L as J,ac as O,aU as Q,ad as Z,K as ee,M as oe,E as te,X as se,Y as le}from"./index-0e396751.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               */import"./el-form-item-4ed993c7.js";/* empty css                 */import{w as ne}from"./order-3f7fd991.js";const ae=l("p",null,"商家主动退款功能仅作为退款维权业务的补充功能，请勿过度依赖和使用。此功能支持多次退款操作。",-1),de=l("p",null,"如果订单项全部退款，运费将在最后一次退款时一并退还，同时使用的优惠券也将返还给用户，退款金额将原路返还至用户的支付账户。",-1),re={class:"text-[red]"},_e={key:0,class:"text-[#999] text-[24rpx]"},ie={class:"flex cursor-pointer"},ue={class:"flex items-center min-w-[50px] mr-[10px]"},ce=["src"],fe={key:1,class:"w-[50px] h-[50px]",src:"",alt:""},me={class:"flex flex-col items-start"},pe={class:"max-w-[250px]"},ye={class:"multi-hidden text-[14px]"},ve={class:"text-[12px] text-[#999] truncate"},xe={key:0,class:"px-[4px] text-[12px] text-[#fff] rounded-[4px] bg-primary leading-[18px]"},he={class:"flex flex-col"},ge={class:"text-[13px]"},be={class:"flex flex-col"},ke={class:"text-[13px]"},we={class:"flex flex-col"},Ee={class:"text-[13px] mt-[5px]"},Fe={class:"dialog-footer"},Ke=L({__name:"shop-active-refund",emits:["complete"],setup(De,{expose:D,emit:T}){const y=m(!1),c=m(!1),V={order_goods_ids:[],refund_money:0,shop_active_refund_remark:""},g=m([]),b=m(null),e=q({...V}),k=m();let h=0,f=m(!1);const C=(t,o)=>{e.refund_money=0,f.value=!1,e.order_goods_ids=[],t.forEach((n,u)=>{e.refund_money+=n.refund_money,e.order_goods_ids.push(n.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),f.value=!0),e.refund_money=e.refund_money.toFixed(2)},R=t=>{e.refund_money=0,f.value=!1,e.order_goods_ids=[],t.forEach((o,n)=>{e.refund_money+=o.refund_money,e.order_goods_ids.push(o.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),f.value=!0),e.refund_money=e.refund_money.toFixed(2)},S=(t,o)=>{let n=!1;return t.status==1&&(n=!0),t.is_gift==1&&(n=!1),n},A=async t=>{if(!(c.value||!t)){if(e.order_goods_ids.length<=0){X({message:_("refundGoodsPlaceholder"),type:"warning"});return}await t.validate(async o=>{if(o){c.value=!0;const n=Y(e);n.shop_active_refund_money=e.refund_money,delete n.refund_money,ne(n).then(u=>{c.value=!1,y.value=!1,T("complete"),I()}).catch(u=>{})}})}},B=async(t=null)=>{c.value=!0,t&&(h=0,e.refund_money=0,e.order_goods_ids=[],g.value=t.order_goods,g.value.forEach((o,n,u)=>{u[n].refund_money=o.goods_money-o.discount_money,o.status==1&&(h++,e.refund_money+=u[n].refund_money,e.order_goods_ids.push(o.order_goods_id))}),e.delivery_money=t.delivery_money,e.refund_money+=parseFloat(t.delivery_money),f.value=!0,e.refund_money=e.refund_money.toFixed(2),e.shop_active_refund_remark=""),j(()=>{setTimeout(()=>{b.value.toggleAllSelection()},100)}),c.value=!1},I=()=>{e.order_goods_id=0,e.refund_money=0,e.shop_active_refund_status="partial_refund",e.shop_active_money_type="back_refund",e.shop_active_refund_remark=""};return D({showDialog:y,setFormData:B}),(t,o)=>{const n=H,u=J,v=O,N=Q,G=Z,M=ee,P=oe,w=te,U=se,$=le;return p(),z(U,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=s=>y.value=s),title:r(_)("refundTitle"),width:"800px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:a(()=>[l("span",Fe,[d(w,{onClick:o[1]||(o[1]=s=>y.value=!1)},{default:a(()=>[E(i(r(_)("cancel")),1)]),_:1}),d(w,{type:"primary",loading:c.value,onClick:o[2]||(o[2]=s=>A(k.value))},{default:a(()=>[E(i(r(_)("confirm")),1)]),_:1},8,["loading"])])]),default:a(()=>[K((p(),x("div",null,[d(n,{type:"warning",closable:!1,class:"!mb-[10px]"},{default:a(()=>[ae,de]),_:1}),d(P,{model:e,"label-width":"100px",ref_key:"formRef",ref:k,rules:t.formRules,class:"page-form mb-[30px]"},{default:a(()=>[d(u,{label:r(_)("refundMoney")},{default:a(()=>[l("div",re,[l("span",null,"￥"+i(e.refund_money),1),r(f)?(p(),x("span",_e,"（运费:￥"+i(e.delivery_money)+"）",1)):F("",!0)])]),_:1},8,["label"]),d(u,{label:r(_)("refundGoodsItem")},{default:a(()=>[d(G,{data:g.value,size:"large",ref_key:"refundTableRef",ref:b,onSelect:C,onSelectAll:R},{default:a(()=>[d(v,{type:"selection",width:"40",selectable:S}),d(v,{align:"left","min-width":"200",label:r(_)("refundGoodsInfo")},{default:a(({row:s})=>[l("div",ie,[l("div",ue,[s.goods_image?(p(),x("img",{key:0,class:"w-[50px] h-[50px]",src:r(W)(s.goods_image),alt:""},null,8,ce)):(p(),x("img",fe))]),l("div",me,[d(N,{class:"box-item",effect:"light",placement:"top"},{content:a(()=>[l("div",pe,i(s.goods_name),1)]),default:a(()=>[l("p",ye,i(s.goods_name),1)]),_:2},1024),l("span",ve,i(s.sku_name),1),s.is_gift==1?(p(),x("span",xe,"赠品")):F("",!0)])])]),_:1},8,["label"]),d(v,{"min-width":"60",label:r(_)("refundPayPrice")},{default:a(({row:s})=>[l("div",he,[l("span",ge,"￥"+i(s.refund_money),1)])]),_:1},8,["label"]),d(v,{"min-width":"80",label:r(_)("refundGoodsPrice")},{default:a(({row:s})=>[l("div",be,[l("span",ke,"￥"+i(s.price),1)])]),_:1},8,["label"]),d(v,{"min-width":"60",label:r(_)("refundGoodsNum")},{default:a(({row:s})=>[l("div",we,[l("span",Ee,i(s.num)+i(r(_)("piece")),1)])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["label"]),d(u,{label:r(_)("refundInstructions"),prop:"shop_active_refund_remark"},{default:a(()=>[d(M,{modelValue:e.shop_active_refund_remark,"onUpdate:modelValue":o[0]||(o[0]=s=>e.shop_active_refund_remark=s),modelModifiers:{trim:!0},rows:5,type:"textarea",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])),[[$,c.value]])]),_:1},8,["modelValue","title"])}}});export{Ke as _};
