import{d as _e,y as fe,f as be,r as u,q as ge,m as ye,s as o,h as p,c as y,e as l,w as i,u as r,aP as ve,i as b,t as d,F as P,T as J,v,a as c,C as w,B as K,U as Q,aQ as he,a7 as xe,at as we,au as Ce,L as Ve,ab as ke,aC as Ee,K as Te,E as Ie,M as Pe,ax as Re,ac as Fe,J as Se,ad as Ue,ay as Me,a3 as De}from"./index-0e396751.js";/* empty css                    *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                *//* empty css                  */import{_ as $e}from"./index.vue_vue_type_style_index_0_lang-27b4ff6d.js";import qe from"./index-11d71036.js";/* empty css                 *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 *//* empty css                *//* empty css                   *//* empty css                       */import{_ as W}from"./default_img-44957769.js";import{g as Ne}from"./topic-ac64237f.js";import{g as Be,e as Le,a as je}from"./content-6035851c.js";import{f as Oe}from"./category-e2645452.js";import{_ as Ae}from"./select-member.vue_vue_type_script_setup_true_lang-313260fc.js";import Ge from"./treasure-select-popup-98075306.js";/* empty css                  *//* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-34f8a01a.js";import"./index.vue_vue_type_style_index_0_lang-d82568af.js";import"./attachment-c52133c7.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-077a27b1.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-5014406f.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./sortable.esm-be94e56d.js";import"./member_head-d9fd7b2c.js";import"./member-fcb60d7e.js";import"./treasure-315db2bb.js";const He={class:"main-container"},ze={class:"ml-[10px]"},Je=c("div",{class:"text-[#999] text-[12px]"},"默认第一张为封面图,建议尺寸：226 * 300px",-1),Ke={key:0,class:"!w-[200px] border-[1px] border-[#e4e4e4] border-solid px-[11px] h-[33px]"},Qe={class:"mb-[10px] flex items-center"},We={class:"flex items-center cursor-pointer"},Xe={class:"min-w-[70px] h-[70px] flex items-center justify-center"},Ye=c("div",{class:"image-slot"},[c("img",{class:"w-[70px] h-[70px]",src:W})],-1),Ze={key:1,class:"w-[70px] h-[70px]",src:W,fit:"contain"},et={class:"ml-2 flex flex-col items-start"},tt=["title"],ot={class:"text-primary text-[12px]"},at={class:"fixed-footer-wrap"},lt={class:"fixed-footer"},ro=_e({__name:"edit",setup(nt){const R=fe(),k=be(),C=u(!1),E=u("basic"),t=ge({...{content_id:"",content_type:1,category_id:"",content_title:"",content:"",content_image:"",topic_ids:[],content_video:"",content_cover:"",member_id:"",headimg:"",nickname:"",treasure_ids:[],content_cover_height:"",content_cover_width:""}});t.content_id=R.query.content_id;const F=()=>{const n=t.content_image.split(",");let e=K(t.content_type==1?n[0]:t.content_cover);const s=new Image;s.src=e,s.onload=async()=>{t.content_cover_width=s.width,t.content_cover_height=s.height,console.log(t.content_cover_width,t.content_cover_height)}},X=()=>{Be(t.content_id).then(n=>{Object.keys(t).forEach(e=>{n.data[e]!=null&&(t[e]=n.data[e])}),t.nickname=n.data.member?n.data.member.nickname:"",t.topic_ids=n.data.topic_ids&&n.data.topic_ids.map(e=>Number(e)),t.treasure_ids=n.data.treasure_ids&&n.data.treasure_ids.map(e=>Number(e)),f.value=n.data.treasure_list||[],F()})};R.query.content_id&&X();const S=ye(()=>({category_id:[{required:!0,message:o("categoryIdPlaceholder"),trigger:"blur"}],content:[{required:!0,message:o("contentPlaceholder"),trigger:"blur"}],content_image:[{required:!0,message:o("contentImagePlaceholder"),trigger:"blur"}],content_video:[{required:!0,message:o("contentVideoPlaceholder"),trigger:"blur"}],content_cover:[{required:!0,message:o("contentCoverPlaceholder"),trigger:"blur"}]})),U=u([]);(()=>{Ne().then(n=>{U.value=n.data})})();const M=u([]),D=(n=!1)=>{Oe().then(e=>{M.value=e.data,n&&Q({message:o("refreshSuccess"),type:"success"})})};D();const $=u(null),Y=()=>{$.value.open()},Z=n=>{t.member_id=n.member_id,t.headimg=n.headimg,t.nickname=n.nickname},q=u(null),ee=()=>{q.value.open()},T=u([]),te=u(),f=u([]),oe=n=>{f.value=n},ae=n=>{T.value=n},le=()=>{if(T.value.length==0){Q({type:"warning",message:`${o("batchEmptySelectedGoodsTips")}`});return}const n=[];T.value.forEach(e=>{n.push(e.treasure_id)}),n.forEach(e=>{f.value.forEach((s,m)=>{s.treasure_id==e&&f.value.splice(m,1)}),t.treasure_ids=t.treasure_ids.filter(s=>s!=e)})},ne=(n,e)=>{f.value.splice(e,1),t.treasure_ids=t.treasure_ids.filter(s=>s!=n)},N=u(),B=u(),re=n=>{const e=[{key:"basic",verify:!1,ref:N.value},{key:"addCowry",verify:!1,ref:B.value}];e.forEach((s,m)=>{s.ref.validate(V=>{s.verify=V})}),setTimeout(()=>{let s=!0;for(let m=0;m<e.length;m++)if(e[m].verify==!1){E.value=e[m].key,s=!1;break}s&&n&&n()},10)},L=n=>{F()},ie=(n=null)=>{re(()=>{if(C.value)return;C.value=!0;const e=t.content_id?Le:je;t.treasure_ids=f.value.map(m=>m.treasure_id);const s=De(t);n&&Object.assign(s,n(s)),e(s).then(m=>{C.value=!1,k.push("/sow_community/content/list")}).catch(()=>{C.value=!1})})},j=()=>{k.push("/sow_community/content/list")},se=()=>{const n=k.resolve({path:"/sow_community/category/list"});window.open(n.href)};return(n,e)=>{const s=he,m=xe,V=we,ce=Ce,_=Ve,O=ke,A=Ee,I=Te,G=qe,de=$e,g=Ie,H=Pe,z=Re,h=Fe,me=Se,pe=Ue,ue=Me;return p(),y("div",He,[l(m,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[l(s,{content:t.content_id?r(o)("updateContent"):r(o)("addContent"),icon:r(ve),onBack:e[0]||(e[0]=a=>j())},null,8,["content","icon"])]),_:1}),l(m,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:i(()=>[l(ue,{modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=a=>E.value=a)},{default:i(()=>[l(z,{label:r(o)("basicInfoTab"),name:"basic"},{default:i(()=>[l(H,{model:t,"label-width":"120px",ref_key:"basicFormRef",ref:N,rules:r(S),class:"page-form"},{default:i(()=>[l(_,{label:r(o)("contentType"),prop:"content_type"},{default:i(()=>[l(ce,{class:"mx-[10px]",modelValue:t.content_type,"onUpdate:modelValue":e[1]||(e[1]=a=>t.content_type=a)},{default:i(()=>[l(V,{label:1},{default:i(()=>[b(d(r(o)("imageText")),1)]),_:1}),l(V,{label:2},{default:i(()=>[b(d(r(o)("shortVideo")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(_,{label:r(o)("categoryId"),prop:"category_id"},{default:i(()=>[l(A,{modelValue:t.category_id,"onUpdate:modelValue":e[2]||(e[2]=a=>t.category_id=a),placeholder:r(o)("categoryIdPlaceholder"),clearable:"",class:"input-width"},{default:i(()=>[(p(!0),y(P,null,J(M.value,(a,x)=>(p(),v(O,{key:x,label:a.category_name,value:a.category_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),c("div",ze,[c("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:e[3]||(e[3]=a=>D(!0))},d(r(o)("refresh")),1),c("span",{class:"cursor-pointer text-primary",onClick:se},d(r(o)("addCategory")),1)])]),_:1},8,["label"]),l(_,{label:r(o)("contentTitle"),prop:"content_title"},{default:i(()=>[l(I,{modelValue:t.content_title,"onUpdate:modelValue":e[4]||(e[4]=a=>t.content_title=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("contentTitlePlaceholder"),class:"input-width",maxlength:"60","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:r(o)("content"),prop:"content"},{default:i(()=>[l(I,{modelValue:t.content,"onUpdate:modelValue":e[5]||(e[5]=a=>t.content=a),type:"textarea",rows:"4",clearable:"",placeholder:r(o)("contentPlaceholder"),class:"input-width",maxlength:"300","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t.content_type==1?(p(),v(_,{key:0,label:r(o)("contentImage"),prop:"content_image"},{default:i(()=>[c("div",null,[l(G,{modelValue:t.content_image,"onUpdate:modelValue":e[6]||(e[6]=a=>t.content_image=a),limit:9,onChange:L},null,8,["modelValue"]),Je])]),_:1},8,["label"])):w("",!0),t.content_type==2?(p(),y(P,{key:1},[l(_,{label:r(o)("contentVideo"),prop:"content_video"},{default:i(()=>[c("div",null,[l(de,{modelValue:t.content_video,"onUpdate:modelValue":e[7]||(e[7]=a=>t.content_video=a),limit:1},null,8,["modelValue"]),l(I,{modelValue:t.content_video,"onUpdate:modelValue":e[8]||(e[8]=a=>t.content_video=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("contentVideoTips"),class:"input-width mt-[10px]"},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),l(_,{label:r(o)("contentCover"),prop:"content_cover"},{default:i(()=>[l(G,{modelValue:t.content_cover,"onUpdate:modelValue":e[9]||(e[9]=a=>t.content_cover=a),limit:1,onChange:L},null,8,["modelValue"])]),_:1},8,["label"])],64)):w("",!0),l(_,{label:r(o)("topicId"),prop:"topic_ids"},{default:i(()=>[l(A,{modelValue:t.topic_ids,"onUpdate:modelValue":e[10]||(e[10]=a=>t.topic_ids=a),placeholder:r(o)("topicIdPlaceholder"),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","multiple-limit":5,clearable:"",class:"input-width"},{default:i(()=>[(p(!0),y(P,null,J(U.value,(a,x)=>(p(),v(O,{key:x,label:a.topic_name,value:a.topic_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t.member_id||!t.content_id?(p(),v(_,{key:2,label:r(o)("selectMember"),prop:"member_id"},{default:i(()=>[t.member_id?(p(),y("div",Ke,d(t.nickname),1)):w("",!0),t.content_id?w("",!0):(p(),v(g,{key:1,class:"ml-[10px]",type:"primary",onClick:Y},{default:i(()=>[b(d(t.nickname?r(o)("reselectMember"):r(o)("selectMember")),1)]),_:1}))]),_:1},8,["label"])):w("",!0)]),_:1},8,["model","rules"])]),_:1},8,["label"]),l(z,{label:r(o)("addCowryTab"),name:"addCowry"},{default:i(()=>[l(H,{model:t,"label-width":"120px",ref_key:"addCowryFormRef",ref:B,rules:r(S),class:"page-form"},{default:i(()=>[c("div",Qe,[l(g,{type:"primary",onClick:e[11]||(e[11]=a=>ee())},{default:i(()=>[b(d(r(o)("addCowry")),1)]),_:1}),l(g,{onClick:le},{default:i(()=>[b(d(r(o)("batchDeleteCowry")),1)]),_:1})]),l(pe,{data:f.value,size:"large",ref_key:"cwryTableRef",ref:te,onSelectionChange:ae},{empty:i(()=>[c("span",null,d(f.value.length?"":r(o)("emptyData")),1)]),default:i(()=>[l(h,{type:"selection",width:"55"}),l(h,{label:r(o)("cwryInfo"),"min-width":"300"},{default:i(({row:a})=>[c("div",We,[c("div",Xe,[a.treasure_image?(p(),v(me,{key:0,class:"w-[70px] h-[70px]",src:r(K)(a.treasure_image),fit:"contain"},{error:i(()=>[Ye]),_:2},1032,["src"])):(p(),y("img",Ze))]),c("div",et,[c("span",{title:a.treasure_name,class:"multi-hidden"},d(a.treasure_name),9,tt),c("span",ot,d(a.treasure_sub_name),1)])])]),_:1},8,["label"]),l(h,{prop:"relate_type_name",label:r(o)("relateTypeName"),"min-width":"120"},null,8,["label"]),l(h,{prop:"treasure_price",label:r(o)("treasurePrice"),"min-width":"120"},null,8,["label"]),l(h,{label:r(o)("operation"),fixed:"right",align:"right","min-width":"120"},{default:i(({row:a,$index:x})=>[l(g,{type:"primary",link:"",onClick:st=>ne(a.treasure_id,x)},{default:i(()=>[b(d(r(o)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),c("div",at,[c("div",lt,[l(g,{type:"primary",onClick:e[13]||(e[13]=a=>ie())},{default:i(()=>[b(d(r(o)("save")),1)]),_:1}),l(g,{onClick:e[14]||(e[14]=a=>j())},{default:i(()=>[b(d(r(o)("back")),1)]),_:1})])]),l(Ae,{ref_key:"selectMemberRef",ref:$,onConfirm:Z},null,512),l(Ge,{ref_key:"treasureSelectPopupRef",ref:q,modelValue:t.treasure_ids,"onUpdate:modelValue":e[15]||(e[15]=a=>t.treasure_ids=a),min:1,max:5,onTreasurSelect:oe},null,8,["modelValue"])])}}});export{ro as default};
