import{d as H,y as J,r as v,q as Q,m as X,s,a2 as Z,h as o,c as b,e as r,w as a,R as ee,v as d,u as m,i as _,F as V,T as x,C as p,t as U,a as i,at as le,au as te,L as ae,ab as re,aC as oe,K as se,E as de,M as ie,a7 as ue,Y as ne}from"./index-0e396751.js";/* empty css                   *//* empty css                *//* empty css                *//* empty css                  */import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-406de1d6.js";import pe from"./index-11d71036.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 */import{g as ce,a as _e,c as ge,e as ye,f as fe,h as ve}from"./addon-13a7932a.js";import{g as be}from"./user-cf8803de.js";import"./index.vue_vue_type_style_index_0_lang-d82568af.js";/* empty css                  *//* empty css                   */import"./attachment-c52133c7.js";import"./index.vue_vue_type_script_setup_true_lang-34f8a01a.js";/* empty css                        *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-077a27b1.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-5014406f.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./sortable.esm-be94e56d.js";const Ve={class:"main-container"},xe=i("div",{class:"text-gray-500 text-xs ml-2"}," 系统会员将会发送给系统会员，用户列表将会发送给导入/手动添加的用户列表中的用户 ",-1),he=i("div",{class:"text-gray-500 text-xs ml-2"},"禁用状态将无法发送信息",-1),we=i("div",{class:"text-gray-500 text-xs ml-2"}," 默认不限制，选择将会只给当前等级会员发送消息 ",-1),ke=i("div",{class:"text-gray-500 text-xs ml-2"}," 可输入发送的公司/品牌/LOGO名称等 ",-1),Ie=i("div",{class:"text-gray-500 text-xs ml-2"}," 发送的邮件简要概述，如：云南野生菌限时抢购 ",-1),Ue=i("div",{class:"text-gray-500 text-xs ml-2"}," 本编辑器可能和您选择的邮件厂商的正文格式有所差异，正式发送前请先发送测试邮件确认格式是否正确 ",-1),qe={class:"w-[720px]"},Le=i("div",{class:"text-gray-500 text-xs ml-2"}," 消息模板的ID，短信填写短信厂商申请的模板ID，微信公众号填写类目模板ID ",-1),Ce=i("div",{class:"text-gray-500 text-xs ml-2"}," '{}'内的变量为申请模板变量，请按照模板变量的格式填写,各平台申请可能会有所不同,申请模板时候自行调整即可 ",-1),Pe=i("div",{class:"text-gray-500 text-xs"}," 如：顾客您好{product}已到货,您可前往{url}下单抢占名额;在下面需添加字段'product'和'url'和对应的值 ",-1),De={class:""},Ee={class:"flex items-center mt-[5px]"},Re={class:"flex items-center mt-[5px]"},Ae=i("span",{class:"ml-[10px] mr-4"},[_("字段 "),i("span",{class:"text-red-500"},"*")],-1),Fe={class:"flex items-center mt-[5px] ml-[8px]"},Be=i("span",{class:"ml-[10px] mr-4"},[_("内容 "),i("span",{class:"text-red-500"},"*")],-1),Oe={class:"ml-8"},$e={class:"fixed-footer-wrap"},ze={class:"fixed-footer"},Pl=H({__name:"addon_edit",emits:["complete"],setup(Ne,{expose:O,emit:Te}){const $=J(),P=parseInt($.query.id),D=v([]);(async()=>{D.value=await(await _e({})).data})();const E=v([]);(async()=>{E.value=await(await be({})).data})();const R=v([]);(async()=>{R.value=await(await ge({})).data})();const q=v();ce().then(g=>{g.data&&(q.value=g.data)});const z=()=>{Array.isArray(e.value)||(e.value=[]),e.value.push({field:"",value:"商品上新"})},N=g=>{e.value.splice(g,1)};let T=v(!1);const h=v(!1),A={id:"",name:"",desc:"",image:"",is_main:1,type:"sms",config_id:"",value:[],is_go_url:"",url:"",page:"",template_id:"",sms_content:"",level_id:-1,cat_id:0,email_content:"",email_title:"",email_desc:"",category_id:"",status:1},e=Q({...A}),F=v(),G=X(()=>({name:[{required:!0,message:s("namePlaceholder"),trigger:"blur"}],desc:[{required:!0,message:s("descPlaceholder"),trigger:"blur"}],image:[{required:!0,message:s("imagePlaceholder"),trigger:"blur"}],sms_content:[{required:!0,message:"请配置短信模板内容",trigger:"blur"}],category_id:[{required:!0,message:"请选择分类",trigger:"blur"}],level_id:[{required:!0,message:"请选择等级",trigger:"blur"}],cat_id:[{required:!0,message:"请选择分类",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],email_content:[{required:!0,message:"请输入邮件正文",trigger:"blur"}],email_title:[{required:!0,message:"请输入邮件标题",trigger:"blur"}],email_desc:[{required:!0,message:"请输入邮件描述",trigger:"blur"}],template_id:[{required:!0,message:"请配置模板ID",trigger:"blur"}],is_main:[{required:!0,message:s("isMainPlaceholder"),trigger:"blur"}],type:[{required:!0,message:s("typePlaceholder"),trigger:"blur"}],config_id:[{required:!0,message:s("configIdPlaceholder"),trigger:"blur"}],value:[{required:!0,message:s("valuePlaceholder"),trigger:"blur"}],is_go_url:[{required:!0,message:s("isGoUrlPlaceholder"),trigger:"blur"}],url:[{required:!0,message:s("urlPlaceholder"),trigger:"blur"}],page:[{required:!0,message:s("pagePlaceholder"),trigger:"blur"}]})),M=async g=>{if(h.value||!g)return;let t=e.id?ye:fe;await g.validate(async c=>{c&&(h.value=!0,t(e).then(u=>{h.value=!1,history.back()}).catch(u=>{h.value=!1}))})},B=async(g=0)=>{Object.assign(e,A);const t=await(await ve(g)).data;Object.keys(e).forEach(c=>{t[c]!=null&&(e[c]=t[c])})};return P&&B(P),O({showDialog:T,setFormData:B}),(g,t)=>{const c=le,w=te,u=ae,f=re,L=oe,y=se,S=pe,C=Z("block"),W=me,k=de,j=ie,K=ue,Y=ne;return o(),b("div",Ve,[r(K,{class:"box-card"},{default:a(()=>[ee((o(),d(j,{model:e,"label-width":"120px",ref_key:"formRef",ref:F,rules:m(G),class:"page-form"},{default:a(()=>[r(u,{label:"发送对象",prop:"is_main"},{default:a(()=>[r(w,{modelValue:e.is_main,"onUpdate:modelValue":t[0]||(t[0]=l=>e.is_main=l)},{default:a(()=>[r(c,{border:"",value:1,size:"large",style:{"margin-right":"10px"}},{default:a(()=>[_("系统会员")]),_:1}),r(c,{border:"",value:0,size:"large",style:{"margin-right":"10px"}},{default:a(()=>[_("用户列表")]),_:1})]),_:1},8,["modelValue"]),xe]),_:1}),r(u,{label:"应用状态",prop:"status"},{default:a(()=>[r(w,{modelValue:e.status,"onUpdate:modelValue":t[1]||(t[1]=l=>e.status=l)},{default:a(()=>[r(c,{value:1,size:"large",style:{"margin-right":"10px"}},{default:a(()=>[_("启用")]),_:1}),r(c,{value:0,size:"large",style:{"margin-right":"10px"}},{default:a(()=>[_("禁用")]),_:1})]),_:1},8,["modelValue"]),he]),_:1}),r(u,{label:m(s)("categoryId"),prop:"category_id"},{default:a(()=>[r(L,{class:"input-width",modelValue:e.category_id,"onUpdate:modelValue":t[2]||(t[2]=l=>e.category_id=l),clearable:"",placeholder:m(s)("categoryIdPlaceholder")},{default:a(()=>[r(f,{label:"请选择",value:""}),(o(!0),b(V,null,x(D.value,(l,n)=>(o(),d(f,{key:n,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:m(s)("name"),prop:"name"},{default:a(()=>[r(y,{modelValue:e.name,"onUpdate:modelValue":t[3]||(t[3]=l=>e.name=l),clearable:"",placeholder:m(s)("namePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:m(s)("desc"),prop:"desc"},{default:a(()=>[r(y,{modelValue:e.desc,"onUpdate:modelValue":t[4]||(t[4]=l=>e.desc=l),clearable:"",placeholder:m(s)("descPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:m(s)("image")},{default:a(()=>[r(S,{modelValue:e.image,"onUpdate:modelValue":t[5]||(t[5]=l=>e.image=l)},null,8,["modelValue"])]),_:1},8,["label"]),e.is_main==1?(o(),d(u,{key:0,label:"会员等级",prop:"level_id"},{default:a(()=>[r(L,{class:"input-width",modelValue:e.level_id,"onUpdate:modelValue":t[6]||(t[6]=l=>e.level_id=l),clearable:"",placeholder:"不限制"},{default:a(()=>[r(f,{label:"不限制",value:-1}),r(f,{label:"默认等级",value:0}),(o(!0),b(V,null,x(R.value,(l,n)=>(o(),d(f,{key:n,label:l.level_name,value:l.level_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),we]),_:1})):p("",!0),e.is_main==0?(o(),d(u,{key:1,label:"选择分类",prop:"cat_id"},{default:a(()=>[r(L,{class:"input-width",modelValue:e.cat_id,"onUpdate:modelValue":t[7]||(t[7]=l=>e.cat_id=l),clearable:"",placeholder:"请选择分类"},{default:a(()=>[r(f,{label:"不限制",value:0}),(o(!0),b(V,null,x(E.value,(l,n)=>(o(),d(f,{key:n,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):p("",!0),e.is_main==1?(o(),d(u,{key:2,label:m(s)("type"),prop:"type"},{default:a(()=>[r(w,{modelValue:e.type,"onUpdate:modelValue":t[8]||(t[8]=l=>e.type=l),placeholder:"请选择类型"},{default:a(()=>[(o(!0),b(V,null,x(q.value,(l,n)=>(o(),d(C,null,{default:a(()=>[n!="email"?(o(),d(c,{style:{"margin-right":"10px"},key:l.name,label:n},{default:a(()=>[_(U(l.name),1)]),_:2},1032,["label"])):p("",!0)]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1},8,["label"])):p("",!0),e.is_main==0?(o(),d(u,{key:3,label:m(s)("type"),prop:"type"},{default:a(()=>[r(w,{modelValue:e.type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.type=l),placeholder:"请选择类型"},{default:a(()=>[(o(!0),b(V,null,x(q.value,(l,n)=>(o(),d(C,null,{default:a(()=>[n!="wechat"?(o(),d(c,{style:{"margin-right":"10px"},key:l.name,label:n},{default:a(()=>[_(U(l.name),1)]),_:2},1032,["label"])):p("",!0)]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1},8,["label"])):p("",!0),e.type=="email"?(o(),d(u,{key:4,label:"邮件标题",prop:"email_title"},{default:a(()=>[r(y,{modelValue:e.email_title,"onUpdate:modelValue":t[10]||(t[10]=l=>e.email_title=l),clearable:"",placeholder:"请输入邮件标题",class:"input-width"},null,8,["modelValue"]),ke]),_:1})):p("",!0),e.type=="email"?(o(),d(u,{key:5,label:"邮件描述",prop:"email_desc"},{default:a(()=>[r(y,{modelValue:e.email_desc,"onUpdate:modelValue":t[11]||(t[11]=l=>e.email_desc=l),clearable:"",placeholder:"请输入邮件描述",class:"input-width"},null,8,["modelValue"]),Ie]),_:1})):p("",!0),e.type=="email"?(o(),d(u,{key:6,label:"邮件正文",prop:"email_content"},{default:a(()=>[Ue]),_:1})):p("",!0),e.type=="email"?(o(),d(u,{key:7},{default:a(()=>[i("div",qe,[r(W,{modelValue:e.email_content,"onUpdate:modelValue":t[12]||(t[12]=l=>e.email_content=l)},null,8,["modelValue"])])]),_:1})):p("",!0),e.type=="wechat"||e.type=="sms"?(o(),d(u,{key:8,label:"模板ID",prop:"template_id"},{default:a(()=>[r(y,{modelValue:e.template_id,"onUpdate:modelValue":t[13]||(t[13]=l=>e.template_id=l),clearable:"",placeholder:"请填入模板ID",class:"input-width"},null,8,["modelValue"]),Le]),_:1})):p("",!0),e.type=="sms"?(o(),d(u,{key:9,label:"短信内容",prop:"sms_content"},{default:a(()=>[r(y,{type:"textarea",modelValue:e.sms_content,"onUpdate:modelValue":t[14]||(t[14]=l=>e.sms_content=l),placeholder:"顾客您好{product}已到货,您可前往{url}下单抢占名额",style:{width:"360px"}},null,8,["modelValue"]),Ce,Pe]),_:1})):p("",!0),e.type=="wechat"||e.type=="sms"?(o(),d(u,{key:10,prop:"value"},{default:a(()=>[i("div",De,[r(k,{onClick:t[15]||(t[15]=l=>z()),type:"primary"},{default:a(()=>[_("添加变量内容")]),_:1}),(o(!0),b(V,null,x(e.value,(l,n)=>(o(),d(C,{key:n},{default:a(()=>[i("div",Ee,[i("div",Re,[Ae,r(y,{style:{width:"120px"},modelValue:l.field,"onUpdate:modelValue":I=>l.field=I,placeholder:"thing8",class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Fe,[Be,r(y,{mini:"0",style:{width:"140px"},modelValue:l.value,"onUpdate:modelValue":I=>l.value=I,placeholder:"对应值",class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Oe,[r(k,{plain:"",onClick:I=>N(n),type:"info"},{default:a(()=>[_("删除")]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])]),_:1})):p("",!0),e.type=="wechat"?(o(),d(u,{key:11,label:m(s)("url"),prop:"url"},{default:a(()=>[r(y,{modelValue:e.url,"onUpdate:modelValue":t[16]||(t[16]=l=>e.url=l),clearable:"",placeholder:m(s)("urlPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):p("",!0)]),_:1},8,["model","rules"])),[[Y,h.value]])]),_:1}),i("div",$e,[i("div",ze,[r(k,{type:"primary",onClick:t[17]||(t[17]=l=>M(F.value))},{default:a(()=>[_(U(m(s)("save")),1)]),_:1}),r(k,{onClick:t[18]||(t[18]=l=>g.back())},{default:a(()=>[_(U(m(s)("cancel")),1)]),_:1})])])])}}});export{Pl as default};
