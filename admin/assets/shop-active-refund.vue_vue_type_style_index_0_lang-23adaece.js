import{d as L,r as m,n as q,h as p,s as z,w as a,a as l,e as n,i as E,t as i,u as r,q as _,R as K,c as v,B as F,A as W,U as X,a$ as Y,aW as j,L as H,ad as J,aa as O,ae as Q,K as Z,M as ee,E as oe,X as te,Y as se}from"./index-904cb7a2.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               */import"./el-form-item-4ed993c7.js";/* empty css                 */import{t as le}from"./order-8e8307b0.js";const ae=l("p",null,"商家主动退款功能仅作为退款维权业务的补充功能，请勿过度依赖和使用。此功能支持多次退款操作。",-1),ne=l("p",null,"如果订单项全部退款，运费将在最后一次退款时一并退还，同时使用的优惠券也将返还给用户，退款金额将原路返还至用户的支付账户。",-1),de={class:"text-[red]"},re={key:0,class:"text-[#999] text-[24rpx]"},_e={class:"flex cursor-pointer"},ie={class:"flex items-center min-w-[50px] mr-[10px]"},ue=["src"],ce={key:1,class:"w-[50px] h-[50px]",src:"",alt:""},fe={class:"flex flex-col items-start"},me={class:"max-w-[250px]"},pe={class:"multi-hidden text-[14px]"},ye={class:"text-[12px] text-[#999] truncate"},xe={key:0,class:"px-[4px] text-[12px] text-[#fff] rounded-[4px] bg-primary leading-[18px]"},ve={class:"flex flex-col"},he={class:"text-[13px]"},ge={class:"flex flex-col"},be={class:"text-[13px]"},ke={class:"flex flex-col"},we={class:"text-[13px] mt-[5px]"},Ee={class:"dialog-footer"},ze=L({__name:"shop-active-refund",emits:["complete"],setup(Fe,{expose:T,emit:V}){const y=m(!1),c=m(!1),D={order_goods_ids:[],refund_money:0,shop_active_refund_remark:""},g=m([]),b=m(null),e=q({...D}),k=m();let h=0,f=m(!1);const R=(t,o)=>{e.refund_money=0,f.value=!1,e.order_goods_ids=[],t.forEach((d,u)=>{e.refund_money+=d.refund_money,e.order_goods_ids.push(d.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),f.value=!0),e.refund_money=e.refund_money.toFixed(2)},A=t=>{e.refund_money=0,f.value=!1,e.order_goods_ids=[],t.forEach((o,d)=>{e.refund_money+=o.refund_money,e.order_goods_ids.push(o.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),f.value=!0),e.refund_money=e.refund_money.toFixed(2)},C=(t,o)=>{let d=!1;return t.status==1&&(d=!0),t.is_gift==1&&(d=!1),d},S=async t=>{if(!(c.value||!t)){if(e.order_goods_ids.length<=0){X({message:_("refundGoodsPlaceholder"),type:"warning"});return}await t.validate(async o=>{o&&(c.value=!0,le(e).then(u=>{c.value=!1,y.value=!1,V("complete"),I()}).catch(u=>{}))})}},B=async(t=null)=>{c.value=!0,t&&(h=0,e.refund_money=0,e.order_goods_ids=[],g.value=t.order_goods,g.value.forEach((o,d,u)=>{u[d].refund_money=o.goods_money-o.discount_money,o.status==1&&(h++,e.refund_money+=u[d].refund_money,e.order_goods_ids.push(o.order_goods_id))}),e.delivery_money=t.delivery_money,e.refund_money+=parseFloat(t.delivery_money),f.value=!0,e.refund_money=e.refund_money.toFixed(2),e.shop_active_refund_remark=""),Y(()=>{setTimeout(()=>{b.value.toggleAllSelection()},100)}),c.value=!1},I=()=>{e.order_goods_id=0,e.refund_money=0,e.shop_active_refund_status="partial_refund",e.shop_active_money_type="back_refund",e.shop_active_refund_remark=""};return T({showDialog:y,setFormData:B}),(t,o)=>{const d=j,u=H,x=J,N=O,G=Q,M=Z,P=ee,w=oe,U=te,$=se;return p(),z(U,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=s=>y.value=s),title:r(_)("refundTitle"),width:"800px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:a(()=>[l("span",Ee,[n(w,{onClick:o[1]||(o[1]=s=>y.value=!1)},{default:a(()=>[E(i(r(_)("cancel")),1)]),_:1}),n(w,{type:"primary",loading:c.value,onClick:o[2]||(o[2]=s=>S(k.value))},{default:a(()=>[E(i(r(_)("confirm")),1)]),_:1},8,["loading"])])]),default:a(()=>[K((p(),v("div",null,[n(d,{type:"warning",closable:!1,class:"!mb-[10px]"},{default:a(()=>[ae,ne]),_:1}),n(P,{model:e,"label-width":"100px",ref_key:"formRef",ref:k,rules:t.formRules,class:"page-form mb-[30px]"},{default:a(()=>[n(u,{label:r(_)("refundMoney")},{default:a(()=>[l("div",de,[l("span",null,"￥"+i(e.refund_money),1),r(f)?(p(),v("span",re,"（运费:￥"+i(e.delivery_money)+"）",1)):F("",!0)])]),_:1},8,["label"]),n(u,{label:r(_)("refundGoodsItem")},{default:a(()=>[n(G,{data:g.value,size:"large",ref_key:"refundTableRef",ref:b,onSelect:R,onSelectAll:A},{default:a(()=>[n(x,{type:"selection",width:"40",selectable:C}),n(x,{align:"left","min-width":"200",label:r(_)("refundGoodsInfo")},{default:a(({row:s})=>[l("div",_e,[l("div",ie,[s.goods_image?(p(),v("img",{key:0,class:"w-[50px] h-[50px]",src:r(W)(s.goods_image),alt:""},null,8,ue)):(p(),v("img",ce))]),l("div",fe,[n(N,{class:"box-item",effect:"light",placement:"top"},{content:a(()=>[l("div",me,i(s.goods_name),1)]),default:a(()=>[l("p",pe,i(s.goods_name),1)]),_:2},1024),l("span",ye,i(s.sku_name),1),s.is_gift==1?(p(),v("span",xe,"赠品")):F("",!0)])])]),_:1},8,["label"]),n(x,{"min-width":"60",label:r(_)("refundPayPrice")},{default:a(({row:s})=>[l("div",ve,[l("span",he,"￥"+i(s.refund_money),1)])]),_:1},8,["label"]),n(x,{"min-width":"80",label:r(_)("refundGoodsPrice")},{default:a(({row:s})=>[l("div",ge,[l("span",be,"￥"+i(s.price),1)])]),_:1},8,["label"]),n(x,{"min-width":"60",label:r(_)("refundGoodsNum")},{default:a(({row:s})=>[l("div",ke,[l("span",we,i(s.num)+i(r(_)("piece")),1)])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["label"]),n(u,{label:r(_)("refundInstructions"),prop:"shop_active_refund_remark"},{default:a(()=>[n(M,{modelValue:e.shop_active_refund_remark,"onUpdate:modelValue":o[0]||(o[0]=s=>e.shop_active_refund_remark=s),modelModifiers:{trim:!0},rows:5,type:"textarea",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])),[[$,c.value]])]),_:1},8,["modelValue","title"])}}});export{ze as _};
