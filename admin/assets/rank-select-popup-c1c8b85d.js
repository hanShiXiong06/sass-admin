import{d as K,l as V,r as x,n as P,h as $,c as W,a as i,b as X,e as r,w as d,i as h,t as p,u as l,q as n,R as b,a0 as S,s as Y,a3 as G,U as D,E as H,K as J,L as Q,M as Z,ad as ee,ae,W as te,X as le,Y as ne,a$ as oe}from"./index-904cb7a2.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  */import{c as re}from"./marketing-fa4978d8.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";const ie={class:"inline-block ml-[10px] text-[14px]"},de={class:"text-primary mx-[2px]"},pe={class:"mt-[16px] flex"},me={class:"flex items-center flex-1"},ue={class:"layui-table-bottom-left-container mr-[10px]"},ce={class:"text-primary mx-[2px]"},_e={class:"dialog-footer"},fe=K({__name:"rank-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue","rankSelect"],setup(T,{expose:z,emit:w}){const u=T,c=V({get(){return u.modelValue},set(t){w("update:modelValue",t)}}),k=x(!1),o=P({}),f=V(()=>Object.keys(o).length),a=P({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{name:"",verify_rank_ids:""}}),C=x(),g=x();x([]);const F=(t,e)=>{if(u.max===1){g.value.clearSelection(),g.value.toggleRowSelection(e,!0);for(const s in o)delete o[s];o["rank_"+e.rank_id]=e}else{let s=!1;for(let _=0;_<t.length;_++)if(t[_].rank_id===e.rank_id){s=!0;break}s?o["rank_"+e.rank_id]=e:delete o["rank_"+e.rank_id]}},L=t=>{if(u.max==1){g.value.clearSelection();for(const e in o)delete o[e]}else t.length?t.forEach(e=>{o["rank_"+e.rank_id]=e}):a.data.forEach(e=>{delete o["rank_"+e.rank_id]})},E=()=>{oe(()=>{if(g.value)for(let t=0;t<a.data.length;t++)g.value.toggleRowSelection(a.data[t],!1),o["rank_"+a.data[t].rank_id]&&g.value.toggleRowSelection(a.data[t],!0)})},y=(t=1,e=null)=>{a.loading=!0,a.page=t;const s=G(a.searchParam);re({page:a.page,limit:a.limit,...s}).then(_=>{a.loading=!1,a.data=_.data.data,a.total=_.data.total,e&&e(_.data.verify_rank_ids),E()}).catch(()=>{a.loading=!1})},N=t=>{t&&(t.resetFields(),a.searchParam.verify_rank_ids="",a.searchParam.name="",y())},B=()=>{a.searchParam.verify_rank_ids=c.value,y(1,t=>{if(c.value){c.value.splice(0,c.value.length,...t),c.value.forEach(e=>{o["rank_"+e]||(o["rank_"+e]={})});for(let e=0;e<a.data.length;e++)c.value.indexOf(a.data[e].rank_id)!=-1&&(o["rank_"+a.data[e].rank_id]=a.data[e])}}),k.value=!0},I=()=>{for(let t in o)delete o[t];E()},U=()=>{if(u.min&&f.value<u.min){D({type:"warning",message:`${n("所选榜单数量不能少于")}${u.min}${n("个")}`});return}if(u.max&&u.max>0&&f.value&&f.value>u.max){D({type:"warning",message:`${n("所选榜单不能超过")}${u.max}${n("个")}`});return}let t=[];for(let e in o)t.push(parseInt(e.replace("rank_","")));c.value.splice(0,c.value.length,...t),w("rankSelect",o),k.value=!1};return z({showDialog:k,selectRank:o,selectRankNum:f}),(t,e)=>{const s=H,_=J,R=Q,M=Z,v=ee,j=ae,A=te,O=le,q=ne;return $(),W("div",null,[i("div",{onClick:B},[X(t.$slots,"default",{},()=>[r(s,null,{default:d(()=>[h(p(l(n)("选择榜单")),1)]),_:1}),b(i("div",ie,[i("span",null,p(l(n)("已选")),1),i("span",de,p(l(c).length),1),i("span",null,p(l(n)("个")),1)],512),[[S,l(c).length]])],!0)]),r(O,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=m=>k.value=m),name:l(n)("榜单选择"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:d(()=>[i("span",_e,[r(s,{onClick:e[6]||(e[6]=m=>k.value=!1)},{default:d(()=>[h(p(l(n)("cancel")),1)]),_:1}),r(s,{type:"primary",onClick:U},{default:d(()=>[h(p(l(n)("confirm")),1)]),_:1})])]),default:d(()=>[r(M,{inline:!0,model:a.searchParam,ref_key:"searchFormRef",ref:C},{default:d(()=>[r(R,{label:l(n)("榜单名称"),prop:"keyword",class:"form-item-wrap"},{default:d(()=>[r(_,{modelValue:a.searchParam.name,"onUpdate:modelValue":e[0]||(e[0]=m=>a.searchParam.name=m),modelModifiers:{trim:!0},placeholder:l(n)("请输入榜单名称"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(R,{class:"form-item-wrap"},{default:d(()=>[r(s,{type:"primary",onClick:e[1]||(e[1]=m=>y())},{default:d(()=>[h(p(l(n)("search")),1)]),_:1}),r(s,{onClick:e[2]||(e[2]=m=>N(C.value))},{default:d(()=>[h(p(l(n)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),b(($(),Y(j,{data:a.data,size:"large",ref_key:"rankListTableRef",ref:g,"max-height":"400",onSelect:F,onSelectAll:L},{empty:d(()=>[i("span",null,p(a.loading?"":l(n)("emptyData")),1)]),default:d(()=>[r(v,{type:"selection",width:"55"}),r(v,{prop:"name",label:l(n)("榜单名称"),"min-width":"130"},null,8,["label"]),r(v,{prop:"show_goods_num",label:l(n)("榜单商品数量"),"min-width":"130"},null,8,["label"]),r(v,{prop:"goods_source_name",label:l(n)("商品来源"),"min-width":"130"},null,8,["label"]),r(v,{prop:"rule_type_name",label:l(n)("排序规则"),"min-width":"130"},null,8,["label"]),r(v,{prop:"rank_type_name",label:l(n)("排行周期"),"min-width":"130"},null,8,["label"])]),_:1},8,["data"])),[[q,a.loading]]),i("div",pe,[i("div",me,[b(i("div",ue,[i("span",null,p(l(n)("已选择")),1),i("span",ce,p(l(f)),1),i("span",null,p(l(n)("个榜单")),1)],512),[[S,l(f)]]),b(r(s,{type:"primary",link:"",onClick:I},{default:d(()=>[h(p(l(n)("取消选择")),1)]),_:1},512),[[S,l(f)]])]),r(A,{"current-page":a.page,"onUpdate:current-page":e[3]||(e[3]=m=>a.page=m),"page-size":a.limit,"onUpdate:page-size":e[4]||(e[4]=m=>a.limit=m),layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:e[5]||(e[5]=m=>y()),onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","name"])])}}});const Ne=se(fe,[["__scopeId","data-v-22da9b49"]]);export{Ne as default};
