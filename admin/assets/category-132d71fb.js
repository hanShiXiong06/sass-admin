import{d as Y,y as A,cG as H,q as K,aJ as Q,a$ as W,r as T,a3 as R,f as X,h as x,c as Z,e as l,w as r,a as m,t as g,u as s,i as v,s as a,R as ee,v as D,B as te,j as $,C as N,a5 as oe,E as ae,ax as se,ay as ie,ac as le,J as ne,ak as re,ad as ce,a7 as de,Y as pe,p as _e,g as me}from"./index-0e396751.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                    *//* empty css                  */import{_ as ue}from"./category_default-57987dd3.js";import{g as ge,u as fe,r as he,s as ye}from"./goods-4d7d064c.js";import{_ as ve}from"./category-edit.vue_vue_type_style_index_0_lang-ead4576e.js";import{_ as be}from"./goods-category-spread-popup.vue_vue_type_script_setup_true_lang-db95fa51.js";import{S as Ce}from"./sortable.esm-be94e56d.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                  */import"./index-11d71036.js";import"./index.vue_vue_type_style_index_0_lang-d82568af.js";import"./attachment-c52133c7.js";import"./index.vue_vue_type_script_setup_true_lang-34f8a01a.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-077a27b1.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-5014406f.js";import"./browser-a1ac24ac.js";const G=b=>(_e("data-v-f40c195e"),b=b(),me(),b),we={class:"main-container"},ke={class:"flex justify-between items-center mb-[5px]"},Ee={class:"text-page-title"},Ie={class:"mt-[10px]"},Te=G(()=>m("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),Re={class:"order-2"},De={class:"h-[30px]"},Se=G(()=>m("div",{class:"image-slot"},[m("img",{class:"w-[30px] h-[30px]",src:ue})],-1)),Be=Y({__name:"category",setup(b){const j=A().meta.title,S=H(),i=K({loading:!0,data:[]});Q(()=>{W(()=>{V()}),w()});const _=T([]),V=()=>{const e=S.value.$el.querySelector(".el-table__body-wrapper tbody");Ce.create(e,{handle:".vues-rank",animation:300,onMove:({dragged:n,related:c})=>{const d=_.value[n.rowIndex],u=_.value[c.rowIndex];if(d.pid!==u.pid)return!1},onStart:()=>{_.value=F(R(i.data))},onEnd:n=>{var C;const c=_.value[n.oldIndex],d=_.value[n.newIndex];if(n.oldIndex===n.newIndex||c.pid!==d.pid||_.value.indexOf(c)<0)return!1;const o=_.value.splice(n.oldIndex,1)[0];_.value.splice(n.newIndex,0,o);const k=d.pid,E=(C=_.value.filter(p=>p.pid===k))==null?void 0:C.map((p,h)=>{if(p.level===1&&p.category_id===o.category_id&&(i.data=i.data.filter(t=>t.category_id!==o.category_id),i.data.splice(h,0,o)),p.level===2&&p.category_id===o.category_id){const t=i.data.findIndex(I=>I.category_id===p.pid),y=R(i.data[t].child_list.filter(I=>I.category_id!==o.category_id));i.data[t].child_list=[],i.data[t].child_list.push(...y),i.data[t].child_list.splice(h,0,o)}return{category_id:p.category_id,sort:9999-h}});L({category_sort_array:E})}})},F=(e,n="child_list")=>{const c=[],d=u=>{u&&u.length>0&&u.filter(o=>o).forEach(o=>{c.push(o),d(o[n]||[])})};return d(e),c},w=()=>{i.loading=!0,ge().then(e=>{i.loading=!1,i.data=e.data}).catch(()=>{i.loading=!1})},L=e=>{fe(e).then(n=>{})},M=e=>{e.is_show=e.is_show===1?2:1;const n=R(e);delete n.child_list,he(n)},f=T(null),P=()=>{f.value.setFormData(),f.value.showDialog=!0},q=e=>{f.value.setFormData(e),f.value.showDialog=!0},J=e=>{oe.confirm(!e.child_list||!e.child_list.length?a("categoryDeleteTips"):a("categoryDeleteTips1"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{ye(e.category_id).then(()=>{w()}).catch(()=>{})})},B=T(null),z=e=>{B.value.show(e)},O=X(),U=e=>{O.push({path:e})};return(e,n)=>{const c=ae,d=se,u=ie,o=le,k=ne,E=re,C=ce,p=de,h=pe;return x(),Z("div",we,[l(p,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[m("div",ke,[m("span",Ee,g(s(j)),1),l(c,{type:"primary",onClick:P},{default:r(()=>[v(g(s(a)("addCategory")),1)]),_:1})]),l(u,{class:"demo-tabs","model-value":"/phone_shop/goods/category",onTabChange:U},{default:r(()=>[l(d,{label:s(a)("tabGoodsCategory"),name:"/phone_shop/goods/category"},null,8,["label"]),l(d,{label:s(a)("tabGoodsCategoryConfig"),name:"/phone_shop/goods/category/config"},null,8,["label"])]),_:1}),m("div",Ie,[ee((x(),D(C,{data:i.data,ref_key:"tableRef",ref:S,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:r(()=>[m("span",null,g(i.loading?"":s(a)("emptyData")),1)]),default:r(()=>[l(o,{label:s(a)("categoryName"),"min-width":"120"},{default:r(({row:t})=>[Te,m("span",Re,g(t.category_name),1)]),_:1},8,["label"]),l(o,{label:s(a)("分类id"),"min-width":"120",prop:"category_id"},null,8,["label"]),l(o,{label:s(a)("memoryGroup"),"min-width":"120",prop:"group_name"},null,8,["label"]),l(o,{label:s(a)("image"),width:"170",align:"left"},{default:r(({row:t})=>[m("div",De,[l(k,{class:"w-[30px] h-[30px]",src:s(te)(t.image),fit:"contain"},{error:r(()=>[Se]),_:2},1032,["src"])])]),_:1},8,["label"]),l(o,{prop:"is_show",label:s(a)("isShow"),width:"400"},{default:r(({row:t})=>[l(E,{class:"cursor-pointer",type:t.is_show!=2?"success":"danger",onClick:y=>M(t)},{default:r(()=>[v(g(t.is_show!=2?"是":"否"),1)]),_:2},1032,["type","onClick"])]),_:1},8,["label"]),l(o,{label:s(a)("operation"),fixed:"right",align:"right",width:"200"},{default:r(({row:t})=>[l(c,{type:"primary",link:"",onClick:y=>z(t)},{default:r(()=>[v(g(s(a)("spreadGoodsCategory")),1)]),_:2},1032,["onClick"]),s($)().siteInfo.site_id==t.site_id?(x(),D(c,{key:0,type:"primary",link:"",onClick:y=>q(t)},{default:r(()=>[v(g(s(a)("edit")),1)]),_:2},1032,["onClick"])):N("",!0),s($)().siteInfo.site_id==t.site_id?(x(),D(c,{key:1,type:"primary",link:"",onClick:y=>J(t)},{default:r(()=>[v(g(s(a)("delete")),1)]),_:2},1032,["onClick"])):N("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[h,i.loading]])]),l(ve,{ref_key:"editCategoryDialog",ref:f,onComplete:w},null,512)]),_:1}),l(be,{ref_key:"goodsCategorySpreadPopupRef",ref:B},null,512)])}}});const xt=xe(Be,[["__scopeId","data-v-f40c195e"]]);export{xt as default};
