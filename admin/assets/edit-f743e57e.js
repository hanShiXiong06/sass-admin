import{d as ge,f as me,y as fe,r as R,q as w,m as he,s as a,a2 as be,h as p,c as y,e as i,w as n,u as l,aP as ye,R as ve,v as f,F as S,T,a as u,t as _,i as V,C as L,B as ke,bU as K,U as q,aI as xe,aQ as Ve,a7 as Ce,K as Ee,L as we,ab as Se,aC as Te,at as Le,au as Pe,J as Re,ac as Ge,a1 as Ue,aU as Be,E as je,ad as qe,bF as Ne,av as De,c8 as Fe,aS as Ie,M as Oe,Y as $e}from"./index-0e396751.js";/* empty css                   *//* empty css                *//* empty css                  *//* empty css                          *//* empty css                    *//* empty css                          *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                 *//* empty css                     *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{_ as J}from"./goods_default-995568ac.js";import{I as Me,J as Ae,K as Ke,L as Je}from"./marketing-c0187315.js";import Qe from"./goods-select-popup-31c232c1.js";import{g as He,E as ze,C as Ye}from"./goods-995cb067.js";/* empty css                  *//* empty css                   *//* empty css                      */import"./_plugin-vue_export-helper-c27b6911.js";const We={class:"main-container"},Xe={class:"ml-[120px] mb-[10px] text-[12px] text-[#999] leading-[20px]"},Ze={class:"flex items-center cursor-pointer"},eo={class:"min-w-[60px] h-[60px] flex items-center justify-center"},oo=u("div",{class:"image-slot"},[u("img",{class:"w-[60px] h-[60px]",src:J})],-1),so={key:1,class:"w-[70px] h-[60px]",src:J,fit:"contain"},ao={class:"ml-2"},lo=["title"],to={class:"text-primary text-[12px]"},ro={style:{display:"inline-flex","align-items":"center"}},no={class:"mr-[5px]"},io={class:"ml-[10px]"},uo={class:"ml-[10px]"},po={class:"ml-[10px]"},co={class:"fixed-footer-wrap"},_o={class:"fixed-footer"},Yo=ge({__name:"edit",setup(go){const v=me(),Q=fe(),b=R(!0),C=Q.query.rank_id,h=R([]),s=w({name:"",goods_source:"all",rank_type:"",sort:"",rule_type:"sale",category_ids:[],status:1,brand_ids:[],label_ids:[],goods_json:[],goods_ids:[]}),k=w({rankTypeList:[],goodsSourceList:[],ruleTypeList:[]}),N=R(),H=he(()=>({name:[{required:!0,message:a("rankNamePlaceholder"),trigger:"blur"}],rule_type:[{required:!0,message:a("ruleTypePlaceholder"),trigger:"change"}],rank_type:[{required:!0,message:a("rankTypePlaceholder"),trigger:"change"}],goods_source:[{required:!0,message:a("goodsSourcePlaceholder"),trigger:"change"}],label_ids:[{validator:(d,e,t)=>{s.goods_source==="label"&&(!e||e.length===0)?t(a("labelTips")):t()},trigger:"change"}],brand_ids:[{required:!0,validator:(d,e,t)=>{s.goods_source==="brand"&&(!e||e.length===0)?t(a("brandTips")):t()},trigger:"change"}],category_ids:[{required:!0,validator:(d,e,t)=>{s.goods_source==="category"&&(!e||e.length===0)?t(a("categoryTips")):t()},trigger:"change"}],goods_json:[{required:!0,trigger:"blur",validator:(d,e,t)=>{s.goods_source=="goods"&&(h.value.length==0?t(new Error(a("goodsJsonEmpty"))):t())}}]}));(()=>{if(Me().then(d=>{b.value=!1,k.rankTypeList=d.data.rank_type,k.goodsSourceList=d.data.goods_source,k.ruleTypeList=d.data.rule_type}),C){b.value=!0;const d=Number(C);Ae(d).then(e=>{const t=e.data;t&&(Object.assign(s,t),s.goods_source=="goods"&&(s.goods_ids.splice(0,s.goods_ids.length),s.goods_json.forEach(r=>{s.goods_ids.push(r.goods_id)})),h.value=t.goods_list.map(r=>({goods_id:r.goods_id,sort:r.sort,price:r.goodsSku.price,goods_type_name:r.goods_type_name,goods_name:r.goods_name,goods_image:r.goodsSku.sku_image})),b.value=!1)})}})();const G=w([]),z={multiple:!0},Y=d=>{console.log(d,s.category_ids,s.category_ids.toString())},W=()=>{const d=v.resolve({path:"/shop/goods/category"});window.open(d.href)},D=(d=!1)=>{He().then(e=>{const t=e.data;if(t){const r=[];t.forEach(m=>{const c=[];m.child_list&&m.child_list.forEach(E=>{c.push({value:E.category_id,label:E.category_name})}),r.push({value:m.category_id,label:m.category_name,children:c})}),G.splice(0,G.length,...r),d&&q({message:a("refreshSuccess"),type:"success"})}})};D();const U=w([]),X=()=>{const d=v.resolve({path:"/shop/goods/brand"});window.open(d.href)},F=(d=!1)=>{ze({}).then(e=>{const t=e.data;t&&(U.splice(0,U.length,...t),d&&q({message:a("refreshSuccess"),type:"success"}))})};F();const B=w([]),Z=()=>{const d=v.resolve({path:"/shop/goods/label"});window.open(d.href)},I=(d=!1)=>{Ye({}).then(e=>{const t=e.data;t&&(B.splice(0,B.length,...t),d&&q({message:a("refreshSuccess"),type:"success"}))})};I();const ee=d=>{let e=[];for(let t in d){let r=d[t],m={goods_id:r.goods_id,price:r.goodsSku.price,goods_type_name:r.goods_type_name,goods_image:r.goods_cover,goods_name:r.goods_name};h.value.length&&h.value.forEach(c=>{c.goods_id==m.goods_id&&(m=Object.assign(m,c))}),e.push(xe(m))}h.value=e},oe=(d,e)=>{h.value.splice(e,1),s.goods_ids.splice(s.goods_ids.indexOf(d.goods_id),1)},x=R(!1),se=async()=>{var d;x.value||await((d=N.value)==null?void 0:d.validate(async e=>{if(e){b.value=!0,s.goods_json=h.value.map(r=>({goods_id:r.goods_id,sort:r.sort}));const t=[];s.category_ids.forEach(r=>{Array.isArray(r)&&r.length===2?t.push(r[1]):Array.isArray(r)&&r.length===1?t.push(r[0]):t.push(r)}),s.category_ids=t,C?(s.id=C,Ke(s).then(r=>{b.value=!1,x.value=!1,r.data&&v.push("/shop/marketing/goods_rank/list")}).catch(()=>{b.value=!1,x.value=!1})):Je(s).then(r=>{b.value=!1,x.value=!1,r.data&&v.push("/shop/marketing/goods_rank/list")}).catch(()=>{b.value=!1,x.value=!1})}else x.value=!1}))},O=()=>{v.push("/shop/marketing/goods_rank/list")};return(d,e)=>{const t=Ve,r=Ce,m=Ee,c=we,E=Se,$=Te,M=Le,A=Pe,ae=Re,P=Ge,le=be("QuestionFilled"),te=Ue,re=Be,j=je,ne=qe,de=Ne,ie=De,ue=Fe,pe=Ie,ce=Oe,_e=$e;return p(),y("div",We,[i(r,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[i(t,{content:l(C)?l(a)("updateRanking"):l(a)("addRanking"),icon:l(ye),onBack:e[0]||(e[0]=o=>O())},null,8,["content","icon"])]),_:1}),ve((p(),f(r,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:n(()=>[i(ce,{model:s,"label-width":"120px",ref_key:"formRef",ref:N,rules:l(H),class:"page-form"},{default:n(()=>[i(c,{label:l(a)("rankName"),prop:"name"},{default:n(()=>[i(m,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=o=>s.name=o),modelModifiers:{trim:!0},clearable:"",placeholder:l(a)("rankNamePlaceholder"),class:"input-width",maxlength:"10","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(c,{label:l(a)("rankType"),prop:"rank_type"},{default:n(()=>[i($,{modelValue:s.rank_type,"onUpdate:modelValue":e[2]||(e[2]=o=>s.rank_type=o),placeholder:l(a)("rankTypePlaceholder"),clearable:""},{default:n(()=>[(p(!0),y(S,null,T(k.rankTypeList,(o,g)=>(p(),f(E,{key:g,label:o,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u("div",Xe,_(l(a)("rankTypeTips")),1),i(c,{label:l(a)("ruleType"),prop:"rule_type"},{default:n(()=>[i(A,{modelValue:s.rule_type,"onUpdate:modelValue":e[3]||(e[3]=o=>s.rule_type=o)},{default:n(()=>[(p(!0),y(S,null,T(k.ruleTypeList,(o,g)=>(p(),f(M,{key:g,label:g},{default:n(()=>[V(_(o),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(c,{label:l(a)("goodsSource"),prop:"goods_source"},{default:n(()=>[i(A,{modelValue:s.goods_source,"onUpdate:modelValue":e[4]||(e[4]=o=>s.goods_source=o)},{default:n(()=>[(p(!0),y(S,null,T(k.goodsSourceList,(o,g)=>(p(),f(M,{key:g,label:g},{default:n(()=>[V(_(o),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.goods_source=="goods"?(p(),f(c,{key:0,label:l(a)("selectGoods"),prop:"goods_json"},{default:n(()=>[i(Qe,{ref:"goodsSelectPopupRef",modelValue:s.goods_ids,"onUpdate:modelValue":e[5]||(e[5]=o=>s.goods_ids=o),onGoodsSelect:ee,min:1,max:99},null,8,["modelValue"])]),_:1},8,["label"])):L("",!0),h.value&&h.value.length&&s.goods_source=="goods"?(p(),f(c,{key:1},{default:n(()=>[i(ne,{data:h.value,size:"large","max-height":"400"},{default:n(()=>[i(P,{prop:"goods_id",label:l(a)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:n(({row:o})=>[u("div",Ze,[u("div",eo,[o.goods_image?(p(),f(ae,{key:0,class:"w-[60px] h-[60px]",src:l(ke)(o.goods_image),fit:"contain"},{error:n(()=>[oo]),_:2},1032,["src"])):(p(),y("img",so))]),u("div",ao,[u("span",{title:o.sku_name,class:"multi-hidden"},_(o.sku_name?o.goods_name+" "+o.sku_name:o.goods_name),9,lo),u("span",to,_(o.goods_type_name),1)])])]),_:1},8,["label"]),i(P,{prop:"price",label:l(a)("goodsSelectPopupPrice"),"min-width":"120"},{default:n(({row:o})=>[u("div",null,"ï¿¥"+_(o.price),1)]),_:1},8,["label"]),i(P,{prop:"sort",label:l(a)("sort"),"min-width":"120"},{header:n(()=>[u("div",ro,[u("span",no,_(l(a)("sort")),1),i(re,{class:"box-item",effect:"light",content:l(a)("sortRules"),placement:"top"},{default:n(()=>[i(te,{color:"#666"},{default:n(()=>[i(le)]),_:1})]),_:1},8,["content"])])]),default:n(({row:o})=>[i(m,{onKeyup:e[6]||(e[6]=g=>l(K)(g)),modelValue:o.sort,"onUpdate:modelValue":g=>o.sort=g,modelModifiers:{number:!0},class:"w-[70px]",maxlength:"8"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),i(P,{label:l(a)("operation"),align:"right","min-width":"160"},{default:n(({row:o,$index:g})=>[i(j,{type:"primary",link:"",onClick:fo=>oe(o,g)},{default:n(()=>[V(_(l(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})):L("",!0),s.goods_source=="category"?(p(),f(c,{key:2,label:l(a)("goodsSelectPopupGoodsCategory"),prop:"category_ids"},{default:n(()=>[i(de,{modelValue:s.category_ids,"onUpdate:modelValue":e[7]||(e[7]=o=>s.category_ids=o),options:G,props:z,clearable:"",filterable:"",onChange:Y,"popper-class":"choice"},null,8,["modelValue","options"]),u("div",io,[u("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:e[8]||(e[8]=o=>D(!0))},_(l(a)("refresh")),1),u("span",{class:"cursor-pointer text-primary",onClick:W},_(l(a)("addCategory")),1)])]),_:1},8,["label"])):L("",!0),s.goods_source=="brand"?(p(),f(c,{key:3,label:l(a)("brand"),prop:"brand_ids"},{default:n(()=>[i($,{modelValue:s.brand_ids,"onUpdate:modelValue":e[9]||(e[9]=o=>s.brand_ids=o),placeholder:l(a)("brandPlaceholder"),clearable:"",multiple:""},{default:n(()=>[(p(!0),y(S,null,T(U,o=>(p(),f(E,{key:o.brand_id,label:o.brand_name,value:o.brand_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),u("div",uo,[u("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:e[10]||(e[10]=o=>F(!0))},_(l(a)("refresh")),1),u("span",{class:"cursor-pointer text-primary",onClick:X},_(l(a)("addBrand")),1)])]),_:1},8,["label"])):L("",!0),s.goods_source=="label"?(p(),f(c,{key:4,label:l(a)("label"),prop:"label_ids"},{default:n(()=>[i(ue,{modelValue:s.label_ids,"onUpdate:modelValue":e[11]||(e[11]=o=>s.label_ids=o)},{default:n(()=>[(p(!0),y(S,null,T(B,(o,g)=>(p(),f(ie,{label:o.label_id,key:g},{default:n(()=>[V(_(o.label_name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),u("div",po,[u("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:I},_(l(a)("refresh")),1),u("span",{class:"cursor-pointer text-primary",onClick:Z},_(l(a)("addLabel")),1)])]),_:1},8,["label"])):L("",!0),i(c,{label:l(a)("sort"),prop:"sort"},{default:n(()=>[i(m,{modelValue:s.sort,"onUpdate:modelValue":e[12]||(e[12]=o=>s.sort=o),modelModifiers:{number:!0},clearable:"",placeholder:l(a)("sortPlaceholder"),class:"input-width",maxlength:"8","show-word-limit":"",onKeyup:e[13]||(e[13]=o=>l(K)(o)),onBlur:e[14]||(e[14]=o=>s.sort=o.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(c,{label:l(a)("isShow"),prop:"status"},{default:n(()=>[i(pe,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=o=>s.status=o),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})),[[_e,b.value]]),u("div",co,[u("div",_o,[i(j,{type:"primary",onClick:e[16]||(e[16]=o=>se())},{default:n(()=>[V(_(l(a)("save")),1)]),_:1}),i(j,{onClick:e[17]||(e[17]=o=>O())},{default:n(()=>[V(_(l(a)("cancel")),1)]),_:1})])])])}}});export{Yo as default};
